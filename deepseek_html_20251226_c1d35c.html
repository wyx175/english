<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¬åŠ›è¯æ±‡åˆ†ç±»å­¦ä¹ ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- å¼•å…¥SheetJSåº“ç”¨äºç”Ÿæˆå’Œè§£æExcelæ–‡ä»¶ -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f9fbfd;
            color: #333;
            line-height: 1.6;
            overscroll-behavior-y: contain;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            background: linear-gradient(135deg, #6a89cc, #4a69bd);
            color: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(106, 137, 204, 0.2);
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 0.95rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 10px;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .scene-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .scene-btn {
            padding: 8px 16px;
            background-color: #f0f4ff;
            border: 2px solid #e1e8ff;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            color: #4a69bd;
            font-size: 0.9rem;
        }
        
        .scene-btn:hover {
            background-color: #e1e8ff;
            transform: translateY(-2px);
        }
        
        .scene-btn.active {
            background-color: #4a69bd;
            color: white;
            border-color: #4a69bd;
        }
        
        .search-box {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 15px 20px 15px 50px;
            border: 2px solid #e1e8ff;
            border-radius: 30px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: white;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #6a89cc;
            box-shadow: 0 0 0 3px rgba(106, 137, 204, 0.2);
        }
        
        .search-box i {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #6a89cc;
        }
        
        .scene-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .scene-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #f0f4ff;
            position: relative;
        }
        
        .scene-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }
        
        .scene-header {
            padding: 15px;
            color: #2c3e50;
            position: relative;
            border-bottom: 1px solid #f0f4ff;
        }
        
        .scene-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .scene-count {
            background-color: #f0f4ff;
            color: #4a69bd;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .scene-content {
            padding: 15px;
        }
        
        .subcategory {
            margin-bottom: 20px;
            position: relative;
        }
        
        .subcategory h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #4a69bd;
            padding-bottom: 6px;
            border-bottom: 2px solid #f0f4ff;
        }
        
        .vocab-item {
            padding: 10px 0;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            position: relative;
        }
        
        .vocab-item:last-child {
            border-bottom: none;
        }
        
        .vocab-english {
            font-weight: bold;
            font-size: 1rem;
            color: #2c3e50;
            width: 40%;
            cursor: pointer;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .vocab-english:hover {
            color: #4a69bd;
        }
        
        .vocab-english.speaking {
            color: #4CAF50;
        }
        
        .speak-icon {
            color: #6a89cc;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        
        .vocab-english:hover .speak-icon {
            opacity: 1;
        }
        
        .vocab-phonetic {
            font-family: "Arial", sans-serif;
            color: #666;
            width: 30%;
            font-size: 0.9rem;
        }
        
        .vocab-chinese {
            color: #4a69bd;
            font-weight: 500;
            width: 30%;
            font-size: 0.95rem;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #666;
            border-top: 1px solid #eee;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
        }
        
        @media (max-width: 768px) {
            .scene-container {
                grid-template-columns: 1fr;
            }
            
            .vocab-english, .vocab-phonetic, .vocab-chinese {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .scene-filter {
                flex-direction: column;
                align-items: center;
            }
            
            .scene-btn {
                width: 90%;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.85rem;
            }
            
            .scene-header h2 {
                font-size: 1.2rem;
            }
            
            .subcategory h3 {
                font-size: 1rem;
            }
            
            .vocab-english {
                font-size: 0.95rem;
            }
            
            .search-box input {
                padding: 18px 20px 18px 50px;
                font-size: 1.1rem;
            }
            
            /* é˜²æ­¢æ‰‹æœºç«¯è¾“å…¥æ¡†æ”¾å¤§ */
            input, textarea, select {
                font-size: 16px !important;
            }
            
            /* æ”¹å–„è§¦æ‘¸ä½“éªŒ */
            button, .scene-btn, .vocab-english {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* è‡ªå®šä¹‰åœºæ™¯ */
        .custom-scene .scene-header { background-color: #fff0f5; }
        .custom-scene .scene-header h2 { color: #e91e63; }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            min-width: 100px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f4ff;
            flex: 1;
        }
        
        .stat-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4a69bd;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.8rem;
        }
        
        .highlight {
            background-color: #fffacd;
            padding: 3px 6px;
            border-radius: 4px;
        }
        
        /* å¯¼å‡ºæŒ‰é’®æ ·å¼ */
        .export-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 12px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.2);
            flex: 1;
            justify-content: center;
            min-width: 160px;
        }
        
        .export-btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .export-btn.secondary {
            background-color: #6a89cc;
        }
        
        .export-btn.secondary:hover {
            background-color: #5a79bc;
        }
        
        .export-btn i {
            font-size: 1.1rem;
        }
        
        .export-options {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f4ff;
        }
        
        .export-options h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #4a69bd;
            font-size: 1.1rem;
        }
        
        .export-options label {
            display: block;
            margin-bottom: 10px;
            color: #555;
        }
        
        .export-options input[type="checkbox"] {
            margin-right: 10px;
        }
        
        .export-status {
            text-align: center;
            margin-top: 10px;
            color: #4CAF50;
            font-weight: 600;
            min-height: 24px;
            font-size: 0.9rem;
        }
        
        /* è¯­éŸ³æ§åˆ¶æ ·å¼ */
        .speech-controls {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f4ff;
        }
        
        .speech-controls h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #4a69bd;
            font-size: 1.1rem;
        }
        
        .speech-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .speech-btn {
            padding: 12px 20px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(33, 150, 243, 0.2);
            flex: 1;
            justify-content: center;
            min-width: 160px;
        }
        
        .speech-btn:hover {
            background-color: #0b7dda;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .speech-btn.stop {
            background-color: #f44336;
        }
        
        .speech-btn.stop:hover {
            background-color: #d32f2f;
        }
        
        .speech-btn i {
            font-size: 1.1rem;
        }
        
        .speech-status {
            text-align: center;
            margin-top: 15px;
            color: #666;
            min-height: 24px;
            font-size: 0.9rem;
        }
        
        .speech-settings {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .speech-setting {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .speech-setting label {
            color: #555;
            font-size: 0.85rem;
        }
        
        .speech-setting select, .speech-setting input {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            font-size: 0.85rem;
        }
        
        .speech-progress {
            width: 100%;
            height: 6px;
            background-color: #f0f4ff;
            border-radius: 3px;
            margin-top: 15px;
            overflow: hidden;
            display: none;
        }
        
        .speech-progress-bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .current-word {
            text-align: center;
            font-weight: bold;
            color: #4a69bd;
            margin-top: 10px;
            min-height: 24px;
            font-size: 0.95rem;
        }
        
        .browser-support {
            text-align: center;
            font-size: 0.8rem;
            color: #888;
            margin-top: 10px;
        }
        
        /* è‡ªå®šä¹‰è¯æ±‡ç®¡ç†æ ·å¼ */
        .custom-vocab-controls {
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #f0f4ff;
        }
        
        .custom-vocab-controls h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #e91e63;
            font-size: 1.1rem;
        }
        
        .custom-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .custom-btn {
            padding: 12px 20px;
            background-color: #e91e63;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(233, 30, 99, 0.2);
            flex: 1;
            justify-content: center;
            min-width: 160px;
        }
        
        .custom-btn:hover {
            background-color: #d81b60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }
        
        .custom-btn.secondary {
            background-color: #9c27b0;
        }
        
        .custom-btn.secondary:hover {
            background-color: #8e24aa;
        }
        
        .custom-btn i {
            font-size: 1.1rem;
        }
        
        .custom-status {
            text-align: center;
            margin-top: 15px;
            color: #e91e63;
            font-weight: 600;
            min-height: 24px;
            font-size: 0.9rem;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
            display: none;
        }
        
        .modal {
            background-color: white;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #f0f4ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            color: #4a69bd;
            font-size: 1.1rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .modal-content {
            padding: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
            font-size: 0.95rem;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #6a89cc;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background-color: #4a69bd;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #3a59ad;
        }
        
        .btn-secondary {
            background-color: #f0f4ff;
            color: #4a69bd;
        }
        
        .btn-secondary:hover {
            background-color: #e1e8ff;
        }
        
        .btn-danger {
            background-color: #f44336;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #d32f2f;
        }
        
        /* è‡ªå®šä¹‰è¯æ±‡é¡¹æ“ä½œæŒ‰é’® */
        .vocab-actions {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .vocab-item:hover .vocab-actions {
            opacity: 1;
        }
        
        .vocab-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #999;
            font-size: 0.8rem;
            padding: 5px;
            border-radius: 4px;
        }
        
        .vocab-action-btn:hover {
            color: #4a69bd;
            background-color: #f0f4ff;
        }
        
        .delete-btn:hover {
            color: #f44336;
        }
        
        /* åœºæ™¯æ“ä½œæŒ‰é’® */
        .scene-actions {
            position: absolute;
            right: 15px;
            top: 15px;
            display: flex;
            gap: 8px;
        }
        
        .scene-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
            font-size: 0.9rem;
            padding: 5px;
            border-radius: 4px;
        }
        
        .scene-action-btn:hover {
            color: #4a69bd;
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .delete-scene-btn:hover {
            color: #f44336;
        }
        
        /* åˆ†ç±»æ“ä½œæŒ‰é’® */
        .category-actions {
            position: absolute;
            right: 0;
            top: 0;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .subcategory:hover .category-actions {
            opacity: 1;
        }
        
        /* ç©ºç™½çŠ¶æ€æç¤º */
        .empty-state {
            text-align: center;
            padding: 40px 15px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .empty-state i {
            font-size: 3rem;
            color: #e1e8ff;
            margin-bottom: 15px;
        }
        
        .empty-state h3 {
            color: #4a69bd;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .empty-state p {
            color: #666;
            max-width: 600px;
            margin: 0 auto 20px;
            font-size: 0.95rem;
        }
        
        .quick-start {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .quick-start-btn {
            padding: 12px 25px;
            background-color: #e91e63;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 3px 10px rgba(233, 30, 99, 0.2);
        }
        
        .quick-start-btn:hover {
            background-color: #d81b60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3);
        }
        
        /* æ‰¹é‡æ·»åŠ æ¨¡æ€æ¡† */
        .batch-add-area {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: vertical;
        }
        
        .batch-add-area:focus {
            outline: none;
            border-color: #6a89cc;
        }
        
        .batch-format-hint {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 0.85rem;
        }
        
        .batch-format-hint code {
            background-color: #f0f4ff;
            padding: 2px 6px;
            border-radius: 4px;
            color: #4a69bd;
        }
        
        .import-templates {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }
        
        .template-btn {
            padding: 8px 12px;
            background-color: #f0f4ff;
            border: 1px solid #e1e8ff;
            border-radius: 6px;
            cursor: pointer;
            color: #4a69bd;
            font-weight: 500;
            text-align: left;
            font-size: 0.9rem;
        }
        
        .template-btn:hover {
            background-color: #e1e8ff;
        }
        
        /* æ–‡ä»¶å¯¼å…¥æ¨¡æ€æ¡†æ ·å¼ */
        .import-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }
        
        .import-option {
            border: 1px solid #f0f4ff;
            border-radius: 8px;
            padding: 12px;
            background-color: #f9f9f9;
        }
        
        .import-option h4 {
            color: #4a69bd;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .import-option p {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }
        
        .import-format-example {
            background-color: #fff;
            border: 1px solid #e1e8ff;
            border-radius: 6px;
            padding: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            margin-top: 8px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .import-mode-select {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 12px 0;
        }
        
        .import-mode-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            border: 1px solid #e1e8ff;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .import-mode-option:hover {
            background-color: #f0f4ff;
        }
        
        .import-mode-option.selected {
            background-color: #e1e8ff;
            border-color: #4a69bd;
        }
        
        .import-mode-option input {
            margin: 0;
        }
        
        .import-mode-option label {
            flex: 1;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .import-mode-desc {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            padding-left: 24px;
        }
        
        /* æ–‡ä»¶å¯¼å…¥è¿›åº¦æŒ‡ç¤ºå™¨ */
        .import-progress {
            display: none;
            margin-top: 15px;
        }
        
        .import-progress-bar {
            width: 100%;
            height: 8px;
            background-color: #f0f4ff;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .import-progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .import-progress-text {
            text-align: center;
            color: #666;
            font-size: 0.85rem;
        }
        
        /* å¯¼å…¥ç»“æœç»Ÿè®¡ */
        .import-results {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            display: none;
        }
        
        .import-results h4 {
            color: #4a69bd;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .result-stat {
            text-align: center;
            padding: 8px;
            background-color: white;
            border-radius: 6px;
            border: 1px solid #f0f4ff;
        }
        
        .result-number {
            font-size: 1.3rem;
            font-weight: bold;
            color: #4a69bd;
        }
        
        .result-label {
            font-size: 0.75rem;
            color: #666;
        }
        
        .result-details {
            max-height: 150px;
            overflow-y: auto;
            background-color: white;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #f0f4ff;
            font-size: 0.8rem;
        }
        
        .result-details ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .result-details li {
            margin-bottom: 5px;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            .custom-btn, .export-btn, .speech-btn {
                padding: 15px 20px;
                font-size: 1.1rem;
                width: 100%;
                margin-bottom: 10px;
                min-width: unset;
            }
            
            .custom-buttons, .export-controls, .speech-buttons {
                flex-direction: column;
            }
            
            .modal {
                max-width: 95%;
            }
            
            .form-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .stat-card {
                width: 100%;
            }
        }
        
        /* æ·»åŠ ä¸»å±å¹•å›¾æ ‡ */
        .pwa-install {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4a69bd;
            color: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(74, 105, 189, 0.3);
            cursor: pointer;
            z-index: 100;
            display: none;
        }
        
        .pwa-install i {
            font-size: 1.5rem;
        }
    </style>
    <!-- æ·»åŠ åˆ°ä¸»å±å¹•çš„æç¤º -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“š</text></svg>">
</head>
<body>
    <!-- æ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’® -->
    <div class="pwa-install" id="pwaInstallBtn" title="æ·»åŠ åˆ°ä¸»å±å¹•">
        <i class="fas fa-plus"></i>
    </div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-language"></i> å¬åŠ›è¯æ±‡åˆ†ç±»å­¦ä¹ ç³»ç»Ÿ</h1>
            <p class="subtitle">å®Œå…¨è‡ªå®šä¹‰çš„è¯æ±‡å­¦ä¹ å¹³å°ï¼ŒæŒ‰åœºæ™¯åˆ†ç±»ï¼ŒåŒ…å«ä¸­æ–‡é‡Šä¹‰ä¸éŸ³æ ‡ï¼Œæ”¯æŒè¯­éŸ³æœ—è¯»å’Œå¯¼å‡ºåŠŸèƒ½</p>
        </header>
        
        <div class="stats">
            <div class="stat-card">
                <div id="totalScenes" class="stat-number">0</div>
                <div class="stat-label">å­¦ä¹ åœºæ™¯</div>
            </div>
            <div class="stat-card">
                <div id="totalWords" class="stat-number">0</div>
                <div class="stat-label">æ ¸å¿ƒè¯æ±‡</div>
            </div>
            <div class="stat-card">
                <div id="totalCategories" class="stat-number">0</div>
                <div class="stat-label">åˆ†ç±»ä¸»é¢˜</div>
            </div>
        </div>
        
        <!-- ç©ºç™½çŠ¶æ€æç¤º -->
        <div id="emptyState" class="empty-state">
            <i class="fas fa-language"></i>
            <h3>æ‚¨çš„è¯æ±‡åº“æ˜¯ç©ºçš„</h3>
            <p>å¼€å§‹åˆ›å»ºæ‚¨çš„ä¸ªæ€§åŒ–è¯æ±‡åº“å§ï¼æ‚¨å¯ä»¥æ·»åŠ åœºæ™¯ã€åˆ†ç±»å’Œè¯æ±‡ï¼Œæ„å»ºå®Œå…¨å±äºè‡ªå·±çš„å­¦ä¹ å†…å®¹ã€‚</p>
            <div class="quick-start">
                <button id="quickStartBtn" class="quick-start-btn">
                    <i class="fas fa-bolt"></i> å¿«é€Ÿå¼€å§‹ - åˆ›å»ºç¬¬ä¸€ä¸ªåœºæ™¯
                </button>
                <p style="font-size: 0.9rem; color: #888;">æˆ–ä½¿ç”¨ä¸‹æ–¹çš„è‡ªå®šä¹‰è¯æ±‡ç®¡ç†åŠŸèƒ½æ·»åŠ å†…å®¹</p>
            </div>
        </div>
        
        <div class="custom-vocab-controls">
            <h3><i class="fas fa-plus-circle"></i> è‡ªå®šä¹‰è¯æ±‡ç®¡ç†</h3>
            <div class="custom-buttons">
                <button id="addSceneBtn" class="custom-btn">
                    <i class="fas fa-layer-group"></i> æ·»åŠ æ–°åœºæ™¯
                </button>
                <button id="addCategoryBtn" class="custom-btn secondary">
                    <i class="fas fa-folder-plus"></i> æ·»åŠ æ–°åˆ†ç±»
                </button>
                <button id="addVocabBtn" class="custom-btn">
                    <i class="fas fa-plus"></i> æ·»åŠ æ–°è¯æ±‡
                </button>
                <button id="batchAddBtn" class="custom-btn secondary">
                    <i class="fas fa-copy"></i> æ‰¹é‡æ·»åŠ è¯æ±‡
                </button>
                <button id="manageCustomBtn" class="custom-btn">
                    <i class="fas fa-cog"></i> ç®¡ç†è‡ªå®šä¹‰å†…å®¹
                </button>
                <button id="importFileBtn" class="custom-btn secondary">
                    <i class="fas fa-file-import"></i> å¯¼å…¥æ–‡ä»¶
                </button>
            </div>
            <div class="custom-status" id="customStatus"></div>
        </div>
        
        <div class="export-options">
            <h3><i class="fas fa-download"></i> å¯¼å‡ºé€‰é¡¹</h3>
            <div class="export-controls">
                <button id="exportAllBtn" class="export-btn">
                    <i class="fas fa-file-excel"></i> å¯¼å‡ºå…¨éƒ¨è¯æ±‡
                </button>
                <button id="exportCurrentBtn" class="export-btn secondary">
                    <i class="fas fa-file-export"></i> å¯¼å‡ºå½“å‰æ˜¾ç¤ºè¯æ±‡
                </button>
            </div>
            <div class="export-status" id="exportStatus"></div>
        </div>
        
        <div class="speech-controls">
            <h3><i class="fas fa-volume-up"></i> è¯­éŸ³æœ—è¯»åŠŸèƒ½</h3>
            <div class="speech-buttons">
                <button id="speakAllBtn" class="speech-btn">
                    <i class="fas fa-play"></i> æœ—è¯»å…¨éƒ¨æ˜¾ç¤ºå•è¯
                </button>
                <button id="speakCurrentBtn" class="speech-btn">
                    <i class="fas fa-headphones"></i> æœ—è¯»å½“å‰åœºæ™¯
                </button>
                <button id="stopSpeakBtn" class="speech-btn stop">
                    <i class="fas fa-stop"></i> åœæ­¢æœ—è¯»
                </button>
            </div>
            
            <div class="speech-settings">
                <div class="speech-setting">
                    <label for="speechRate">è¯­é€Ÿ:</label>
                    <select id="speechRate">
                        <option value="0.7">æ…¢</option>
                        <option value="0.9" selected>ä¸­</option>
                        <option value="1.1">å¿«</option>
                    </select>
                </div>
                <div class="speech-setting">
                    <label for="speechPitch">éŸ³è°ƒ:</label>
                    <select id="speechPitch">
                        <option value="0.8">ä½</option>
                        <option value="1" selected>ä¸­</option>
                        <option value="1.2">é«˜</option>
                    </select>
                </div>
                <div class="speech-setting">
                    <label for="speechVolume">éŸ³é‡:</label>
                    <input type="range" id="speechVolume" min="0" max="1" step="0.1" value="1">
                </div>
            </div>
            
            <div class="speech-progress" id="speechProgress">
                <div class="speech-progress-bar" id="speechProgressBar"></div>
            </div>
            
            <div class="current-word" id="currentWord"></div>
            <div class="speech-status" id="speechStatus"></div>
            <div class="browser-support" id="browserSupport"></div>
        </div>
        
        <div class="controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="æœç´¢è‹±æ–‡æˆ–ä¸­æ–‡è¯æ±‡...">
            </div>
        </div>
        
        <div class="scene-filter">
            <button class="scene-btn active" data-scene="all">å…¨éƒ¨åœºæ™¯</button>
            <!-- åœºæ™¯æŒ‰é’®å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
        </div>
        
        <div class="scene-container" id="sceneContainer">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <footer>
            <p><strong>å¬åŠ›è¯æ±‡åˆ†ç±»å­¦ä¹ ç³»ç»Ÿ</strong> &copy; 2023 | å®Œå…¨è‡ªå®šä¹‰çš„è¯æ±‡å­¦ä¹ å¹³å°</p>
            <p style="margin-top: 10px; font-size: 0.85rem;">æç¤ºï¼šæ‰€æœ‰å†…å®¹å‡å¯è‡ªå®šä¹‰æ·»åŠ ã€ç¼–è¾‘å’Œåˆ é™¤ï¼Œæ”¯æŒè¯­éŸ³æœ—è¯»ã€æœç´¢å’Œå¯¼å‡ºåŠŸèƒ½</p>
            <p style="margin-top: 10px; font-size: 0.8rem; color: #e91e63;"><i class="fas fa-info-circle"></i> è¿™æ˜¯ä¸€ä¸ªçº¯å‡€ç‰ˆæœ¬ï¼Œæ‰€æœ‰å†…å®¹éƒ½éœ€è¦æ‚¨è‡ªè¡Œæ·»åŠ </p>
        </footer>
    </div>

    <!-- æ·»åŠ æ–°åœºæ™¯æ¨¡æ€æ¡† -->
    <div id="addSceneModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-layer-group"></i> æ·»åŠ æ–°åœºæ™¯</h3>
                <button class="modal-close" data-modal="addSceneModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="addSceneForm">
                    <div class="form-group">
                        <label for="sceneName">åœºæ™¯åç§° *</label>
                        <input type="text" id="sceneName" placeholder="ä¾‹å¦‚ï¼šæ ¡å›­å­¦ä¹ " required>
                    </div>
                    <div class="form-group">
                        <label for="sceneDescription">åœºæ™¯æè¿°</label>
                        <textarea id="sceneDescription" rows="3" placeholder="æè¿°æ­¤åœºæ™¯çš„ä¸»è¦å†…å®¹..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="sceneColor">åœºæ™¯é¢œè‰²</label>
                        <select id="sceneColor">
                            <option value="#e91e63">ç²‰è‰²</option>
                            <option value="#ff9800">æ©™è‰²</option>
                            <option value="#4CAF50">ç»¿è‰²</option>
                            <option value="#2196F3">è“è‰²</option>
                            <option value="#9c27b0">ç´«è‰²</option>
                            <option value="#00bcd4">é’è‰²</option>
                            <option value="#1e88e5">æ·±è“</option>
                            <option value="#43a047">æ·±ç»¿</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="addSceneModal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æ·»åŠ åœºæ™¯</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ æ–°åˆ†ç±»æ¨¡æ€æ¡† -->
    <div id="addCategoryModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-folder-plus"></i> æ·»åŠ æ–°åˆ†ç±»</h3>
                <button class="modal-close" data-modal="addCategoryModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="addCategoryForm">
                    <div class="form-group">
                        <label for="categoryScene">é€‰æ‹©åœºæ™¯ *</label>
                        <select id="categoryScene" required>
                            <!-- åœºæ™¯é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="categoryName">åˆ†ç±»åç§° *</label>
                        <input type="text" id="categoryName" placeholder="ä¾‹å¦‚ï¼šè¯¾ç¨‹ä¸å­¦ä¸š" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="addCategoryModal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æ·»åŠ åˆ†ç±»</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ æ–°è¯æ±‡æ¨¡æ€æ¡† -->
    <div id="addVocabModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> æ·»åŠ æ–°è¯æ±‡</h3>
                <button class="modal-close" data-modal="addVocabModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="addVocabForm">
                    <div class="form-group">
                        <label for="vocabScene">é€‰æ‹©åœºæ™¯ *</label>
                        <select id="vocabScene" required>
                            <!-- åœºæ™¯é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="vocabCategory">é€‰æ‹©åˆ†ç±» *</label>
                        <select id="vocabCategory" required>
                            <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vocabEnglish">è‹±æ–‡å•è¯ *</label>
                            <input type="text" id="vocabEnglish" placeholder="ä¾‹å¦‚ï¼šlecture" required>
                        </div>
                        <div class="form-group">
                            <label for="vocabPhonetic">éŸ³æ ‡</label>
                            <input type="text" id="vocabPhonetic" placeholder="ä¾‹å¦‚ï¼š/ËˆlekÊ§É™r/">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="vocabChinese">ä¸­æ–‡é‡Šä¹‰ *</label>
                        <input type="text" id="vocabChinese" placeholder="ä¾‹å¦‚ï¼šè®²åº§" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="addVocabModal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æ·»åŠ è¯æ±‡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡æ·»åŠ è¯æ±‡æ¨¡æ€æ¡† -->
    <div id="batchAddModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-copy"></i> æ‰¹é‡æ·»åŠ è¯æ±‡</h3>
                <button class="modal-close" data-modal="batchAddModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="batchAddForm">
                    <div class="form-group">
                        <label for="batchScene">é€‰æ‹©åœºæ™¯ *</label>
                        <select id="batchScene" required>
                            <!-- åœºæ™¯é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="batchCategory">é€‰æ‹©åˆ†ç±» *</label>
                        <select id="batchCategory" required>
                            <!-- åˆ†ç±»é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="batchContent">è¯æ±‡å†…å®¹ *</label>
                        <textarea id="batchContent" class="batch-add-area" placeholder="æ¯è¡Œä¸€ä¸ªè¯æ±‡ï¼Œæ ¼å¼ï¼šè‹±æ–‡[ç©ºæ ¼]éŸ³æ ‡[ç©ºæ ¼]ä¸­æ–‡&#10;ä¾‹å¦‚ï¼š&#10;lecture /ËˆlekÊ§É™r/ è®²åº§&#10;seminar /ËˆsemÉªnÉ‘Ër/ ç ”è®¨ä¼š&#10;assignment /É™ËˆsaÉªnmÉ™nt/ ä½œä¸š" required></textarea>
                    </div>
                    
                    <div class="batch-format-hint">
                        <p><strong>æ ¼å¼è¯´æ˜ï¼š</strong></p>
                        <p>æ¯è¡Œä¸€ä¸ªè¯æ±‡ï¼Œæ ¼å¼ä¸ºï¼š<code>è‹±æ–‡ éŸ³æ ‡ ä¸­æ–‡</code></p>
                        <p>éŸ³æ ‡å¯é€‰ï¼Œå¦‚æœæ²¡æœ‰éŸ³æ ‡ï¼Œå¯ä»¥ä½¿ç”¨<code>è‹±æ–‡ ä¸­æ–‡</code>æ ¼å¼</p>
                        <p>ç¤ºä¾‹ï¼š</p>
                        <pre>lecture /ËˆlekÊ§É™r/ è®²åº§
seminar /ËˆsemÉªnÉ‘Ër/ ç ”è®¨ä¼š
assignment /É™ËˆsaÉªnmÉ™nt/ ä½œä¸š
presentation è¯¾å ‚å±•ç¤º</pre>
                    </div>
                    
                    <div class="import-templates">
                        <p><strong>å¿«é€Ÿå¯¼å…¥æ¨¡æ¿ï¼š</strong></p>
                        <button type="button" class="template-btn" data-template="campus">æ ¡å›­å­¦ä¹ è¯æ±‡æ¨¡æ¿</button>
                        <button type="button" class="template-btn" data-template="daily">æ—¥å¸¸ç”Ÿæ´»è¯æ±‡æ¨¡æ¿</button>
                        <button type="button" class="template-btn" data-template="travel">æ—…è¡Œè¯æ±‡æ¨¡æ¿</button>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="batchAddModal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">æ‰¹é‡æ·»åŠ </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†è‡ªå®šä¹‰å†…å®¹æ¨¡æ€æ¡† -->
    <div id="manageCustomModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> ç®¡ç†è‡ªå®šä¹‰å†…å®¹</h3>
                <button class="modal-close" data-modal="manageCustomModal">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <h4>è‡ªå®šä¹‰åœºæ™¯åˆ—è¡¨</h4>
                    <div id="customScenesList" style="margin-top: 10px;">
                        <!-- è‡ªå®šä¹‰åœºæ™¯åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                <div class="form-group">
                    <h4>æ•°æ®ç®¡ç†</h4>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button id="exportCustomBtn" class="btn btn-secondary">
                            <i class="fas fa-download"></i> å¯¼å‡ºè‡ªå®šä¹‰å†…å®¹
                        </button>
                        <button id="importCustomBtn" class="btn btn-secondary">
                            <i class="fas fa-upload"></i> å¯¼å…¥JSONæ–‡ä»¶
                        </button>
                        <button id="resetCustomBtn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> é‡ç½®æ‰€æœ‰è‡ªå®šä¹‰å†…å®¹
                        </button>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="manageCustomModal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘è¯æ±‡æ¨¡æ€æ¡† -->
    <div id="editVocabModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> ç¼–è¾‘è¯æ±‡</h3>
                <button class="modal-close" data-modal="editVocabModal">&times;</button>
            </div>
            <div class="modal-content">
                <form id="editVocabForm">
                    <input type="hidden" id="editVocabId">
                    <div class="form-group">
                        <label for="editVocabEnglish">è‹±æ–‡å•è¯ *</label>
                        <input type="text" id="editVocabEnglish" required>
                    </div>
                    <div class="form-group">
                        <label for="editVocabPhonetic">éŸ³æ ‡</label>
                        <input type="text" id="editVocabPhonetic">
                    </div>
                    <div class="form-group">
                        <label for="editVocabChinese">ä¸­æ–‡é‡Šä¹‰ *</label>
                        <input type="text" id="editVocabChinese" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" data-modal="editVocabModal">å–æ¶ˆ</button>
                        <button type="submit" class="btn btn-primary">ä¿å­˜æ›´æ”¹</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶å¯¼å…¥æ¨¡æ€æ¡† -->
    <div id="importFileModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-file-import"></i> å¯¼å…¥æ–‡ä»¶</h3>
                <button class="modal-close" data-modal="importFileModal">&times;</button>
            </div>
            <div class="modal-content">
                <div class="form-group">
                    <h4>é€‰æ‹©å¯¼å…¥æ–‡ä»¶æ ¼å¼</h4>
                    <div class="import-options">
                        <div class="import-option">
                            <h4><i class="fas fa-file-excel"></i> Excelæ–‡ä»¶å¯¼å…¥</h4>
                            <p>å¯¼å…¥Excelæ ¼å¼çš„è¯æ±‡æ–‡ä»¶ï¼Œæ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼ã€‚æ–‡ä»¶åº”åŒ…å«ä»¥ä¸‹åˆ—ï¼šåœºæ™¯ã€åˆ†ç±»ã€è‹±æ–‡ã€éŸ³æ ‡ã€ä¸­æ–‡</p>
                            <div class="import-format-example">
                                åœºæ™¯,åˆ†ç±»,è‹±æ–‡,éŸ³æ ‡,ä¸­æ–‡<br>
                                æ ¡å›­å­¦ä¹ ,è¯¾ç¨‹ä¸å­¦ä¸š,lecture,/ËˆlekÊ§É™r/,è®²åº§<br>
                                æ ¡å›­å­¦ä¹ ,è¯¾ç¨‹ä¸å­¦ä¸š,seminar,/ËˆsemÉªnÉ‘Ër/,ç ”è®¨ä¼š<br>
                                æ—¥å¸¸ç”Ÿæ´»,è´­ç‰©æ¶ˆè´¹,discount,/ËˆdÉªskaÊŠnt/,æŠ˜æ‰£
                            </div>
                            <button id="importExcelBtn" class="btn btn-primary" style="margin-top: 10px;">
                                <i class="fas fa-file-excel"></i> é€‰æ‹©Excelæ–‡ä»¶
                            </button>
                        </div>
                        
                        <div class="import-option">
                            <h4><i class="fas fa-file-code"></i> JSONæ–‡ä»¶å¯¼å…¥</h4>
                            <p>å¯¼å…¥JSONæ ¼å¼çš„è¯æ±‡æ–‡ä»¶ï¼Œæ”¯æŒç³»ç»Ÿå¯¼å‡ºçš„JSONæ ¼å¼æˆ–è‡ªå®šä¹‰ç»“æ„</p>
                            <div class="import-format-example">
                                [<br>
                                &nbsp;&nbsp;{<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"scene": "æ ¡å›­å­¦ä¹ ",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"title": "æ ¡å›­å­¦ä¹ ",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;"subcategories": [<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"name": "è¯¾ç¨‹ä¸å­¦ä¸š",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"items": [<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"english": "lecture",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"phonetic": "/ËˆlekÊ§É™r/",<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"chinese": "è®²åº§"<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;]<br>
                                &nbsp;&nbsp;}<br>
                                ]
                            </div>
                            <button id="importJsonBtn" class="btn btn-primary" style="margin-top: 10px;">
                                <i class="fas fa-file-code"></i> é€‰æ‹©JSONæ–‡ä»¶
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <h4>å¯¼å…¥æ¨¡å¼</h4>
                    <div class="import-mode-select">
                        <div class="import-mode-option" id="modeReplace">
                            <input type="radio" id="importModeReplace" name="importMode" value="replace" checked>
                            <label for="importModeReplace">æ›¿æ¢ç°æœ‰æ•°æ®</label>
                            <div class="import-mode-desc">æ¸…ç©ºç°æœ‰æ•°æ®ï¼Œå®Œå…¨æ›¿æ¢ä¸ºå¯¼å…¥æ–‡ä»¶çš„å†…å®¹</div>
                        </div>
                        <div class="import-mode-option" id="modeMerge">
                            <input type="radio" id="importModeMerge" name="importMode" value="merge">
                            <label for="importModeMerge">åˆå¹¶åˆ°ç°æœ‰æ•°æ®</label>
                            <div class="import-mode-desc">å°†å¯¼å…¥æ–‡ä»¶çš„å†…å®¹åˆå¹¶åˆ°ç°æœ‰æ•°æ®ä¸­ï¼Œä¿ç•™åŸæœ‰æ•°æ®</div>
                        </div>
                    </div>
                </div>
                
                <div class="import-progress" id="importProgress">
                    <div class="import-progress-bar">
                        <div class="import-progress-fill" id="importProgressFill"></div>
                    </div>
                    <div class="import-progress-text" id="importProgressText">å‡†å¤‡å¯¼å…¥...</div>
                </div>
                
                <div class="import-results" id="importResults">
                    <h4>å¯¼å…¥ç»“æœ</h4>
                    <div class="result-stats" id="importResultStats">
                        <!-- ç»“æœç»Ÿè®¡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="result-details" id="importResultDetails">
                        <!-- ç»“æœè¯¦æƒ…å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" data-modal="importFileModal">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶å¯¼å…¥è¾“å…¥æ¡†ï¼ˆéšè—ï¼‰ -->
    <input type="file" id="importExcelInput" accept=".xlsx,.xls" style="display: none;">
    <input type="file" id="importJsonInput" accept=".json" style="display: none;">
    <input type="file" id="importFileInput" accept=".json" style="display: none;">

    <script>
        // è¯æ±‡æ•°æ® - å®Œå…¨ä¸ºç©ºï¼Œç­‰å¾…ç”¨æˆ·æ·»åŠ 
        let vocabularyData = [];
        
        // è¯­éŸ³åˆæˆç›¸å…³å˜é‡
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let isSpeaking = false;
        let wordQueue = [];
        let currentWordIndex = 0;
        let currentSpeakingElement = null;
        
        // ç”¨äºç”Ÿæˆå”¯ä¸€ID
        let vocabIdCounter = 1000;
        
        // ä»localStorageåŠ è½½è‡ªå®šä¹‰æ•°æ®
        function loadCustomData() {
            const savedCustomData = localStorage.getItem('customVocabularyData');
            if (savedCustomData) {
                try {
                    vocabularyData = JSON.parse(savedCustomData);
                    
                    // æ›´æ–°IDè®¡æ•°å™¨
                    updateIdCounter();
                    
                    console.log("è‡ªå®šä¹‰æ•°æ®å·²åŠ è½½");
                } catch (error) {
                    console.error("åŠ è½½è‡ªå®šä¹‰æ•°æ®å¤±è´¥:", error);
                }
            }
        }
        
        // ä¿å­˜è‡ªå®šä¹‰æ•°æ®åˆ°localStorage
        function saveCustomData() {
            try {
                localStorage.setItem('customVocabularyData', JSON.stringify(vocabularyData));
                console.log("è‡ªå®šä¹‰æ•°æ®å·²ä¿å­˜");
            } catch (error) {
                console.error("ä¿å­˜è‡ªå®šä¹‰æ•°æ®å¤±è´¥:", error);
            }
        }
        
        // æ›´æ–°IDè®¡æ•°å™¨
        function updateIdCounter() {
            let maxId = 0;
            vocabularyData.forEach(scene => {
                scene.subcategories.forEach(category => {
                    category.items.forEach(item => {
                        if (item.id) {
                            const idNum = parseInt(item.id.split('-')[1]);
                            if (idNum > maxId) maxId = idNum;
                        }
                    });
                });
            });
            vocabIdCounter = maxId + 1;
        }
        
        // ç”Ÿæˆæ–°çš„å”¯ä¸€ID
        function generateId() {
            return `custom-${vocabIdCounter++}`;
        }
        
        // ç”Ÿæˆåœºæ™¯ID
        function generateSceneId(sceneName) {
            // ç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼Œç”¨è¿å­—ç¬¦è¿æ¥
            const cleanName = sceneName.toLowerCase()
                .replace(/[^\w\u4e00-\u9fa5]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            // æ·»åŠ æ—¶é—´æˆ³ç¡®ä¿å”¯ä¸€æ€§
            return `scene-${cleanName}-${Date.now()}`;
        }
        
        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³åˆæˆ
        function checkSpeechSupport() {
            const browserSupportEl = document.getElementById("browserSupport");
            if (!speechSynthesis) {
                browserSupportEl.innerHTML = "âš ï¸ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Chromeã€Edgeæˆ–Safariæµè§ˆå™¨";
                document.querySelectorAll(".speech-btn").forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = "0.5";
                    btn.style.cursor = "not-allowed";
                });
                return false;
            } else {
                browserSupportEl.innerHTML = "âœ… æ‚¨çš„æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½";
                return true;
            }
        }
        
        // æœ—è¯»å•ä¸ªå•è¯
        function speakWord(word, element = null) {
            if (!speechSynthesis) return;
            
            // åœæ­¢å½“å‰è¯­éŸ³
            if (currentUtterance) {
                speechSynthesis.cancel();
            }
            
            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
            if (currentSpeakingElement) {
                currentSpeakingElement.classList.remove("speaking");
            }
            
            // é«˜äº®å½“å‰æœ—è¯»çš„å•è¯
            if (element) {
                element.classList.add("speaking");
                currentSpeakingElement = element;
            }
            
            // åˆ›å»ºè¯­éŸ³åˆæˆå¯¹è±¡
            currentUtterance = new SpeechSynthesisUtterance(word);
            currentUtterance.lang = 'en-US';
            currentUtterance.rate = parseFloat(document.getElementById("speechRate").value);
            currentUtterance.pitch = parseFloat(document.getElementById("speechPitch").value);
            currentUtterance.volume = parseFloat(document.getElementById("speechVolume").value);
            
            // æ›´æ–°å½“å‰æœ—è¯»å•è¯æ˜¾ç¤º
            document.getElementById("currentWord").textContent = `æ­£åœ¨æœ—è¯»: ${word}`;
            
            // è¯­éŸ³ç»“æŸäº‹ä»¶
            currentUtterance.onend = function() {
                if (element) {
                    element.classList.remove("speaking");
                }
                document.getElementById("currentWord").textContent = "";
                
                // å¦‚æœæ­£åœ¨æ‰¹é‡æœ—è¯»ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
                if (isSpeaking && wordQueue.length > 0) {
                    setTimeout(() => {
                        speakNextInQueue();
                    }, 500);
                } else {
                    isSpeaking = false;
                    updateSpeechStatus("æœ—è¯»å®Œæˆ");
                    document.getElementById("speechProgress").style.display = "none";
                }
            };
            
            // è¯­éŸ³é”™è¯¯äº‹ä»¶
            currentUtterance.onerror = function(event) {
                console.error("è¯­éŸ³åˆæˆé”™è¯¯:", event);
                if (element) {
                    element.classList.remove("speaking");
                }
                document.getElementById("currentWord").textContent = "";
                updateSpeechStatus("æœ—è¯»å‡ºé”™", false);
                isSpeaking = false;
                document.getElementById("speechProgress").style.display = "none";
            };
            
            // å¼€å§‹æœ—è¯»
            speechSynthesis.speak(currentUtterance);
        }
        
        // ä»é˜Ÿåˆ—ä¸­æœ—è¯»ä¸‹ä¸€ä¸ªå•è¯
        function speakNextInQueue() {
            if (wordQueue.length === 0) {
                isSpeaking = false;
                updateSpeechStatus("æœ—è¯»å®Œæˆ");
                document.getElementById("speechProgress").style.display = "none";
                return;
            }
            
            const nextWord = wordQueue.shift();
            currentWordIndex++;
            
            // æ›´æ–°è¿›åº¦æ¡
            const totalWords = currentWordIndex + wordQueue.length;
            const progress = (currentWordIndex / totalWords) * 100;
            document.getElementById("speechProgressBar").style.width = `${progress}%`;
            
            // æŸ¥æ‰¾å¯¹åº”çš„DOMå…ƒç´ 
            const wordElement = findWordElement(nextWord);
            
            // æœ—è¯»å•è¯
            speakWord(nextWord, wordElement);
            
            // æ›´æ–°çŠ¶æ€
            updateSpeechStatus(`æ­£åœ¨æœ—è¯»: ${currentWordIndex}/${totalWords}`);
        }
        
        // æŸ¥æ‰¾å•è¯å¯¹åº”çš„DOMå…ƒç´ 
        function findWordElement(word) {
            const allWordElements = document.querySelectorAll(".vocab-english");
            for (let element of allWordElements) {
                // è·å–çº¯æ–‡æœ¬å†…å®¹ï¼ˆå»é™¤HTMLæ ‡ç­¾ï¼‰
                const text = element.textContent.replace(/<[^>]*>/g, '').trim();
                if (text === word) {
                    return element;
                }
            }
            return null;
        }
        
        // è·å–æ‰€æœ‰æ˜¾ç¤ºçš„å•è¯
        function getAllDisplayedWords() {
            const wordElements = document.querySelectorAll(".vocab-english");
            const words = [];
            wordElements.forEach(element => {
                // è·å–çº¯æ–‡æœ¬å†…å®¹ï¼ˆå»é™¤HTMLæ ‡ç­¾ï¼‰
                const word = element.textContent.replace(/<[^>]*>/g, '').trim();
                words.push(word);
            });
            return words;
        }
        
        // è·å–å½“å‰åœºæ™¯çš„å•è¯
        function getCurrentSceneWords() {
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            if (activeScene === "all") {
                return getAllDisplayedWords();
            }
            
            const sceneCard = document.querySelector(`.scene-card[data-scene="${activeScene}"]`);
            if (!sceneCard) return [];
            
            const wordElements = sceneCard.querySelectorAll(".vocab-english");
            const words = [];
            wordElements.forEach(element => {
                const word = element.textContent.replace(/<[^>]*>/g, '').trim();
                words.push(word);
            });
            return words;
        }
        
        // å¼€å§‹æ‰¹é‡æœ—è¯»
        function startBatchSpeaking(words) {
            if (words.length === 0) {
                updateSpeechStatus("æ²¡æœ‰å•è¯å¯ä»¥æœ—è¯»", false);
                return;
            }
            
            // åœæ­¢å½“å‰è¯­éŸ³
            if (isSpeaking) {
                stopSpeaking();
            }
            
            // é‡ç½®é˜Ÿåˆ—
            wordQueue = [...words];
            currentWordIndex = 0;
            isSpeaking = true;
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            document.getElementById("speechProgress").style.display = "block";
            document.getElementById("speechProgressBar").style.width = "0%";
            
            // æ›´æ–°çŠ¶æ€
            updateSpeechStatus(`å¼€å§‹æœ—è¯» ${words.length} ä¸ªå•è¯...`);
            
            // å¼€å§‹æœ—è¯»
            speakNextInQueue();
        }
        
        // åœæ­¢æœ—è¯»
        function stopSpeaking() {
            if (speechSynthesis && speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            isSpeaking = false;
            wordQueue = [];
            currentWordIndex = 0;
            
            // æ¸…é™¤é«˜äº®
            if (currentSpeakingElement) {
                currentSpeakingElement.classList.remove("speaking");
                currentSpeakingElement = null;
            }
            
            // éšè—è¿›åº¦æ¡
            document.getElementById("speechProgress").style.display = "none";
            document.getElementById("currentWord").textContent = "";
            
            updateSpeechStatus("æœ—è¯»å·²åœæ­¢");
        }
        
        // æ›´æ–°è¯­éŸ³çŠ¶æ€
        function updateSpeechStatus(message, isSuccess = true) {
            const statusEl = document.getElementById("speechStatus");
            statusEl.textContent = message;
            statusEl.style.color = isSuccess ? "#4CAF50" : "#f44336";
        }
        
        // æ›´æ–°è‡ªå®šä¹‰çŠ¶æ€
        function updateCustomStatus(message, isSuccess = true) {
            const statusEl = document.getElementById("customStatus");
            statusEl.textContent = message;
            statusEl.style.color = isSuccess ? "#e91e63" : "#f44336";
            
            // 3ç§’åæ¸…é™¤çŠ¶æ€
            setTimeout(() => {
                statusEl.textContent = "";
            }, 3000);
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStatistics() {
            let totalScenes = vocabularyData.length;
            let totalWords = 0;
            let totalCategories = 0;
            
            vocabularyData.forEach(scene => {
                totalCategories += scene.subcategories.length;
                scene.subcategories.forEach(category => {
                    totalWords += category.items.length;
                });
            });
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
            document.getElementById("totalScenes").textContent = totalScenes;
            document.getElementById("totalWords").textContent = totalWords;
            document.getElementById("totalCategories").textContent = totalCategories;
            
            // æ˜¾ç¤º/éšè—ç©ºç™½çŠ¶æ€æç¤º
            const emptyState = document.getElementById("emptyState");
            if (totalScenes === 0) {
                emptyState.style.display = "block";
            } else {
                emptyState.style.display = "none";
            }
        }
        
        // æ¸²æŸ“è¯æ±‡å¡ç‰‡
        function renderVocabulary(sceneFilter = "all", searchTerm = "") {
            const container = document.getElementById("sceneContainer");
            container.innerHTML = "";
            
            let filteredData = vocabularyData;
            
            // æ ¹æ®åœºæ™¯ç­›é€‰
            if (sceneFilter !== "all") {
                filteredData = vocabularyData.filter(item => item.scene === sceneFilter);
            }
            
            // æ ¹æ®æœç´¢è¯ç­›é€‰
            if (searchTerm) {
                filteredData = filteredData.map(scene => {
                    const filteredSubcategories = scene.subcategories.map(subcategory => {
                        const filteredItems = subcategory.items.filter(item => 
                            item.english.toLowerCase().includes(searchTerm.toLowerCase()) || 
                            item.chinese.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            (item.phonetic && item.phonetic.toLowerCase().includes(searchTerm.toLowerCase()))
                        );
                        
                        // é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ–‡æœ¬
                        const highlightedItems = filteredItems.map(item => {
                            const highlightedItem = {...item};
                            if (searchTerm) {
                                const regex = new RegExp(`(${searchTerm})`, 'gi');
                                highlightedItem.english = item.english.replace(regex, '<span class="highlight">$1</span>');
                                highlightedItem.chinese = item.chinese.replace(regex, '<span class="highlight">$1</span>');
                                if (item.phonetic) {
                                    highlightedItem.phonetic = item.phonetic.replace(regex, '<span class="highlight">$1</span>');
                                }
                            }
                            return highlightedItem;
                        });
                        
                        return highlightedItems.length > 0 ? {...subcategory, items: highlightedItems} : null;
                    }).filter(subcategory => subcategory !== null);
                    
                    return filteredSubcategories.length > 0 ? {...scene, subcategories: filteredSubcategories} : null;
                }).filter(scene => scene !== null);
            }
            
            // æ¸²æŸ“ç­›é€‰åçš„æ•°æ®
            filteredData.forEach(scene => {
                // è®¡ç®—è¯¥åœºæ™¯çš„æ€»è¯æ±‡æ•°
                let totalWords = 0;
                scene.subcategories.forEach(subcategory => {
                    totalWords += subcategory.items.length;
                });
                
                const sceneCard = document.createElement("div");
                sceneCard.className = `scene-card custom-scene`;
                sceneCard.dataset.scene = scene.scene;
                
                // åœºæ™¯æ“ä½œæŒ‰é’®
                let sceneActionsHTML = "";
                sceneActionsHTML = `
                    <div class="scene-actions">
                        <button class="scene-action-btn delete-scene-btn" title="åˆ é™¤åœºæ™¯" data-scene="${scene.scene}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                // è®¾ç½®åœºæ™¯æ ‡é¢˜æ ·å¼
                const titleStyle = scene.color ? `color: ${scene.color};` : '';
                const headerStyle = scene.color ? `background-color: ${scene.color}20;` : '';
                
                sceneCard.innerHTML = `
                    <div class="scene-header" style="${headerStyle}">
                        <h2 style="${titleStyle}">${scene.title}</h2>
                        <span class="scene-count">${totalWords} ä¸ªè¯æ±‡</span>
                        ${sceneActionsHTML}
                    </div>
                    <div class="scene-content">
                        ${scene.subcategories.map(subcategory => `
                            <div class="subcategory">
                                <h3>${subcategory.name}</h3>
                                <div class="category-actions">
                                    <button class="vocab-action-btn delete-category-btn" title="åˆ é™¤åˆ†ç±»" data-scene="${scene.scene}" data-category="${subcategory.name}">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                ${subcategory.items.map(item => `
                                    <div class="vocab-item" data-id="${item.id}">
                                        <div class="vocab-english" data-word="${item.english}">
                                            <i class="fas fa-volume-up speak-icon"></i>
                                            ${item.english}
                                        </div>
                                        <div class="vocab-phonetic">${item.phonetic || ''}</div>
                                        <div class="vocab-chinese">${item.chinese}</div>
                                        <div class="vocab-actions">
                                            <button class="vocab-action-btn edit-vocab-btn" title="ç¼–è¾‘è¯æ±‡" data-id="${item.id}">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="vocab-action-btn delete-btn delete-vocab-btn" title="åˆ é™¤è¯æ±‡" data-id="${item.id}">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>
                `;
                
                container.appendChild(sceneCard);
            });
            
            // å¦‚æœæ²¡æœ‰ç»“æœ
            if (filteredData.length === 0) {
                if (vocabularyData.length === 0) {
                    // å¦‚æœå®Œå…¨æ²¡æœ‰æ•°æ®ï¼Œæ˜¾ç¤ºç©ºç™½çŠ¶æ€æç¤º
                    updateStatistics();
                } else {
                    // å¦‚æœæœ‰æ•°æ®ä½†æœç´¢æ²¡æœ‰ç»“æœ
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; width: 100%; background-color: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);">
                            <i class="fas fa-search" style="font-size: 3rem; color: #ccc; margin-bottom: 20px;"></i>
                            <h3 style="color: #666; margin-bottom: 10px;">æœªæ‰¾åˆ°åŒ¹é…çš„è¯æ±‡</h3>
                            <p style="color: #888;">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–é€‰æ‹©å…¶ä»–åœºæ™¯</p>
                        </div>
                    `;
                }
            }
        }
        
        // æ›´æ–°åœºæ™¯ç­›é€‰æŒ‰é’®
        function updateSceneFilterButtons() {
            const sceneFilterContainer = document.querySelector('.scene-filter');
            
            // æ¸…é™¤é"å…¨éƒ¨"æŒ‰é’®
            const allBtn = sceneFilterContainer.querySelector('[data-scene="all"]');
            sceneFilterContainer.innerHTML = '';
            sceneFilterContainer.appendChild(allBtn);
            
            // æ·»åŠ è‡ªå®šä¹‰åœºæ™¯æŒ‰é’®
            vocabularyData.forEach(scene => {
                const sceneBtn = document.createElement('button');
                sceneBtn.className = 'scene-btn';
                sceneBtn.dataset.scene = scene.scene;
                sceneBtn.textContent = scene.title;
                sceneFilterContainer.appendChild(sceneBtn);
            });
            
            // é‡æ–°ç»‘å®šäº‹ä»¶
            bindSceneFilterEvents();
        }
        
        // ç»‘å®šåœºæ™¯ç­›é€‰æŒ‰é’®äº‹ä»¶
        function bindSceneFilterEvents() {
            document.querySelectorAll(".scene-btn").forEach(button => {
                button.addEventListener("click", function() {
                    // æ›´æ–°æ´»åŠ¨æŒ‰é’®
                    document.querySelectorAll(".scene-btn").forEach(btn => btn.classList.remove("active"));
                    this.classList.add("active");
                    
                    // è·å–ç­›é€‰åœºæ™¯
                    const scene = this.dataset.scene;
                    
                    // æ¸²æŸ“ç­›é€‰åçš„è¯æ±‡
                    const searchTerm = document.getElementById("searchInput").value;
                    renderVocabulary(scene, searchTerm);
                });
            });
        }
        
        // å¡«å……åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
        function populateSceneSelect(selectId) {
            const select = document.getElementById(selectId);
            if (!select) {
                console.error(`å…ƒç´  ${selectId} ä¸å­˜åœ¨`);
                return;
            }
            
            select.innerHTML = '';
            
            if (vocabularyData.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'æš‚æ— åœºæ™¯ï¼Œè¯·å…ˆæ·»åŠ åœºæ™¯';
                select.appendChild(option);
                select.disabled = true;
                return;
            }
            
            select.disabled = false;
            vocabularyData.forEach(scene => {
                const option = document.createElement('option');
                option.value = scene.scene;
                option.textContent = scene.title;
                select.appendChild(option);
            });
            
            // è§¦å‘changeäº‹ä»¶ä»¥æ›´æ–°åˆ†ç±»ä¸‹æ‹‰æ¡†
            if (selectId === 'vocabScene' || selectId === 'batchScene') {
                select.dispatchEvent(new Event('change'));
            }
        }
        
        // å¡«å……åˆ†ç±»é€‰æ‹©ä¸‹æ‹‰æ¡†
        function populateCategorySelect(sceneId, selectId) {
            const select = document.getElementById(selectId);
            if (!select) {
                console.error(`å…ƒç´  ${selectId} ä¸å­˜åœ¨`);
                return;
            }
            
            select.innerHTML = '';
            
            const scene = vocabularyData.find(s => s.scene === sceneId);
            if (scene && scene.subcategories && scene.subcategories.length > 0) {
                scene.subcategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.name;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
                select.disabled = false;
            } else {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'æ­¤åœºæ™¯æš‚æ— åˆ†ç±»ï¼Œè¯·å…ˆæ·»åŠ åˆ†ç±»';
                select.appendChild(option);
                select.disabled = true;
            }
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) {
                console.error(`æ¨¡æ€æ¡† ${modalId} ä¸å­˜åœ¨`);
                return;
            }
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
        }
        
        // éšè—æ¨¡æ€æ¡†
        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) {
                console.error(`æ¨¡æ€æ¡† ${modalId} ä¸å­˜åœ¨`);
                return;
            }
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
        }
        
        // æ·»åŠ æ–°åœºæ™¯
        function addNewScene(sceneName, sceneDescription, sceneColor) {
            // ç”Ÿæˆåœºæ™¯ID
            const sceneId = generateSceneId(sceneName);
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒIDçš„åœºæ™¯
            if (vocabularyData.find(scene => scene.scene === sceneId)) {
                updateCustomStatus("å·²å­˜åœ¨ç›¸åŒåç§°çš„åœºæ™¯", false);
                return false;
            }
            
            // åˆ›å»ºæ–°åœºæ™¯
            const newScene = {
                scene: sceneId,
                title: sceneName,
                color: sceneColor,
                description: sceneDescription || "",
                subcategories: []
            };
            
            // æ·»åŠ åˆ°æ•°æ®
            vocabularyData.push(newScene);
            
            // ä¿å­˜åˆ°localStorage
            saveCustomData();
            
            // æ›´æ–°UI
            updateSceneFilterButtons();
            updateStatistics();
            
            // é‡æ–°æ¸²æŸ“ï¼ˆæ˜¾ç¤ºå…¨éƒ¨åœºæ™¯ï¼‰
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            renderVocabulary(activeScene, searchTerm);
            
            // æ›´æ–°åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
            populateSceneSelect('categoryScene');
            populateSceneSelect('vocabScene');
            populateSceneSelect('batchScene');
            
            return true;
        }
        
        // æ·»åŠ æ–°åˆ†ç±»
        function addNewCategory(sceneId, categoryName) {
            // æŸ¥æ‰¾åœºæ™¯
            const scene = vocabularyData.find(s => s.scene === sceneId);
            if (!scene) {
                updateCustomStatus("åœºæ™¯ä¸å­˜åœ¨", false);
                return false;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒåç§°çš„åˆ†ç±»
            if (scene.subcategories.find(cat => cat.name === categoryName)) {
                updateCustomStatus("è¯¥åœºæ™¯ä¸‹å·²å­˜åœ¨ç›¸åŒåç§°çš„åˆ†ç±»", false);
                return false;
            }
            
            // åˆ›å»ºæ–°åˆ†ç±»
            const newCategory = {
                name: categoryName,
                items: []
            };
            
            // æ·»åŠ åˆ°åœºæ™¯
            if (!scene.subcategories) {
                scene.subcategories = [];
            }
            scene.subcategories.push(newCategory);
            
            // ä¿å­˜åˆ°localStorage
            saveCustomData();
            
            // æ›´æ–°UI
            updateStatistics();
            
            // é‡æ–°æ¸²æŸ“ï¼ˆæ˜¾ç¤ºå½“å‰åœºæ™¯ï¼‰
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            renderVocabulary(activeScene, searchTerm);
            
            // æ›´æ–°åˆ†ç±»é€‰æ‹©ä¸‹æ‹‰æ¡†
            populateCategorySelect(sceneId, 'vocabCategory');
            populateCategorySelect(sceneId, 'batchCategory');
            
            return true;
        }
        
        // æ·»åŠ æ–°è¯æ±‡
        function addNewVocab(sceneId, categoryName, english, phonetic, chinese) {
            // æŸ¥æ‰¾åœºæ™¯
            const scene = vocabularyData.find(s => s.scene === sceneId);
            if (!scene) {
                updateCustomStatus("åœºæ™¯ä¸å­˜åœ¨", false);
                return false;
            }
            
            // æŸ¥æ‰¾åˆ†ç±»
            const category = scene.subcategories.find(cat => cat.name === categoryName);
            if (!category) {
                updateCustomStatus("åˆ†ç±»ä¸å­˜åœ¨", false);
                return false;
            }
            
            // åˆ›å»ºæ–°è¯æ±‡
            const newVocab = {
                id: generateId(),
                english: english,
                phonetic: phonetic || "",
                chinese: chinese
            };
            
            // æ·»åŠ åˆ°åˆ†ç±»
            if (!category.items) {
                category.items = [];
            }
            category.items.push(newVocab);
            
            // ä¿å­˜åˆ°localStorage
            saveCustomData();
            
            // æ›´æ–°UI
            updateStatistics();
            
            // é‡æ–°æ¸²æŸ“ï¼ˆæ˜¾ç¤ºå½“å‰åœºæ™¯ï¼‰
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            renderVocabulary(activeScene, searchTerm);
            
            return true;
        }
        
        // æ‰¹é‡æ·»åŠ è¯æ±‡
        function batchAddVocab(sceneId, categoryName, content) {
            // æŸ¥æ‰¾åœºæ™¯
            const scene = vocabularyData.find(s => s.scene === sceneId);
            if (!scene) {
                updateCustomStatus("åœºæ™¯ä¸å­˜åœ¨", false);
                return false;
            }
            
            // æŸ¥æ‰¾åˆ†ç±»
            const category = scene.subcategories.find(cat => cat.name === categoryName);
            if (!category) {
                updateCustomStatus("åˆ†ç±»ä¸å­˜åœ¨", false);
                return false;
            }
            
            // è§£æå†…å®¹
            const lines = content.split('\n').filter(line => line.trim() !== '');
            let addedCount = 0;
            
            for (const line of lines) {
                const parts = line.trim().split(/\s+/);
                
                if (parts.length >= 2) {
                    let english, phonetic, chinese;
                    
                    if (parts.length === 2) {
                        // æ ¼å¼: è‹±æ–‡ ä¸­æ–‡
                        english = parts[0];
                        chinese = parts[1];
                        phonetic = "";
                    } else if (parts.length >= 3) {
                        // æ ¼å¼: è‹±æ–‡ éŸ³æ ‡ ä¸­æ–‡
                        english = parts[0];
                        phonetic = parts[1];
                        chinese = parts.slice(2).join(' '); // ä¸­æ–‡å¯èƒ½åŒ…å«ç©ºæ ¼
                    }
                    
                    // åˆ›å»ºæ–°è¯æ±‡
                    const newVocab = {
                        id: generateId(),
                        english: english,
                        phonetic: phonetic || "",
                        chinese: chinese
                    };
                    
                    // æ·»åŠ åˆ°åˆ†ç±»
                    if (!category.items) {
                        category.items = [];
                    }
                    category.items.push(newVocab);
                    addedCount++;
                }
            }
            
            if (addedCount === 0) {
                updateCustomStatus("æ²¡æœ‰æˆåŠŸæ·»åŠ ä»»ä½•è¯æ±‡ï¼Œè¯·æ£€æŸ¥æ ¼å¼", false);
                return false;
            }
            
            // ä¿å­˜åˆ°localStorage
            saveCustomData();
            
            // æ›´æ–°UI
            updateStatistics();
            
            // é‡æ–°æ¸²æŸ“ï¼ˆæ˜¾ç¤ºå½“å‰åœºæ™¯ï¼‰
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            renderVocabulary(activeScene, searchTerm);
            
            updateCustomStatus(`æˆåŠŸæ‰¹é‡æ·»åŠ  ${addedCount} ä¸ªè¯æ±‡ï¼`);
            return true;
        }
        
        // åˆ é™¤è¯æ±‡
        function deleteVocab(vocabId) {
            // éå†æ‰€æœ‰åœºæ™¯å’Œåˆ†ç±»ï¼Œæ‰¾åˆ°å¹¶åˆ é™¤è¯æ±‡
            for (let scene of vocabularyData) {
                for (let category of scene.subcategories) {
                    const index = category.items.findIndex(item => item.id === vocabId);
                    if (index !== -1) {
                        category.items.splice(index, 1);
                        
                        // å¦‚æœåˆ†ç±»ä¸ºç©ºï¼Œåˆ é™¤åˆ†ç±»
                        if (category.items.length === 0) {
                            const catIndex = scene.subcategories.findIndex(cat => cat.name === category.name);
                            if (catIndex !== -1) {
                                scene.subcategories.splice(catIndex, 1);
                            }
                        }
                        
                        // ä¿å­˜åˆ°localStorage
                        saveCustomData();
                        
                        // æ›´æ–°UI
                        updateStatistics();
                        updateSceneFilterButtons();
                        
                        // é‡æ–°æ¸²æŸ“
                        const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
                        const searchTerm = document.getElementById("searchInput").value;
                        renderVocabulary(activeScene, searchTerm);
                        
                        return true;
                    }
                }
            }
            
            return false;
        }
        
        // ç¼–è¾‘è¯æ±‡
        function editVocab(vocabId, english, phonetic, chinese) {
            // éå†æ‰€æœ‰åœºæ™¯å’Œåˆ†ç±»ï¼Œæ‰¾åˆ°å¹¶ç¼–è¾‘è¯æ±‡
            for (let scene of vocabularyData) {
                for (let category of scene.subcategories) {
                    const vocab = category.items.find(item => item.id === vocabId);
                    if (vocab) {
                        vocab.english = english;
                        vocab.phonetic = phonetic || "";
                        vocab.chinese = chinese;
                        
                        // ä¿å­˜åˆ°localStorage
                        saveCustomData();
                        
                        // é‡æ–°æ¸²æŸ“
                        const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
                        const searchTerm = document.getElementById("searchInput").value;
                        renderVocabulary(activeScene, searchTerm);
                        
                        return true;
                    }
                }
            }
            
            return false;
        }
        
        // åˆ é™¤åˆ†ç±»
        function deleteCategory(sceneId, categoryName) {
            // æŸ¥æ‰¾åœºæ™¯
            const scene = vocabularyData.find(s => s.scene === sceneId);
            if (!scene) return false;
            
            // æŸ¥æ‰¾åˆ†ç±»ç´¢å¼•
            const catIndex = scene.subcategories.findIndex(cat => cat.name === categoryName);
            if (catIndex === -1) return false;
            
            // åˆ é™¤åˆ†ç±»
            scene.subcategories.splice(catIndex, 1);
            
            // å¦‚æœåœºæ™¯ä¸ºç©ºï¼Œåˆ é™¤åœºæ™¯
            if (scene.subcategories.length === 0) {
                const sceneIndex = vocabularyData.findIndex(s => s.scene === sceneId);
                if (sceneIndex !== -1) {
                    vocabularyData.splice(sceneIndex, 1);
                }
            }
            
            // ä¿å­˜åˆ°localStorage
            saveCustomData();
            
            // æ›´æ–°UI
            updateSceneFilterButtons();
            updateStatistics();
            
            // é‡æ–°æ¸²æŸ“
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            renderVocabulary(activeScene, searchTerm);
            
            // æ›´æ–°åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
            populateSceneSelect('categoryScene');
            populateSceneSelect('vocabScene');
            populateSceneSelect('batchScene');
            
            return true;
        }
        
        // åˆ é™¤åœºæ™¯
        function deleteScene(sceneId) {
            // æŸ¥æ‰¾åœºæ™¯ç´¢å¼•
            const sceneIndex = vocabularyData.findIndex(s => s.scene === sceneId);
            if (sceneIndex === -1) return false;
            
            // åˆ é™¤åœºæ™¯
            vocabularyData.splice(sceneIndex, 1);
            
            // ä¿å­˜åˆ°localStorage
            saveCustomData();
            
            // æ›´æ–°UI
            updateSceneFilterButtons();
            updateStatistics();
            
            // é‡æ–°æ¸²æŸ“
            const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            renderVocabulary(activeScene, searchTerm);
            
            // æ›´æ–°åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
            populateSceneSelect('categoryScene');
            populateSceneSelect('vocabScene');
            populateSceneSelect('batchScene');
            
            return true;
        }
        
        // å¯¼å‡ºExcelæ–‡ä»¶
        function exportToExcel(data, fileName = "å¬åŠ›è¯æ±‡") {
            try {
                // å‡†å¤‡Excelæ•°æ®
                const excelData = [
                    ["åœºæ™¯", "åˆ†ç±»", "è‹±æ–‡", "éŸ³æ ‡", "ä¸­æ–‡"], // è¡¨å¤´
                    ...data.flatMap(scene => 
                        scene.subcategories.flatMap(subcategory => 
                            subcategory.items.map(item => [
                                scene.title,
                                subcategory.name,
                                item.english,
                                item.phonetic || "",
                                item.chinese
                            ])
                        )
                    )
                ];
                
                // åˆ›å»ºå·¥ä½œç°¿å’Œå·¥ä½œè¡¨
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "å¬åŠ›è¯æ±‡");
                
                // è®¾ç½®åˆ—å®½
                const wscols = [
                    {wch: 15}, // åœºæ™¯åˆ—å®½
                    {wch: 20}, // åˆ†ç±»åˆ—å®½
                    {wch: 25}, // è‹±æ–‡åˆ—å®½
                    {wch: 25}, // éŸ³æ ‡åˆ—å®½
                    {wch: 25}  // ä¸­æ–‡åˆ—å®½
                ];
                ws['!cols'] = wscols;
                
                // ç”Ÿæˆæ–‡ä»¶åï¼ˆåŒ…å«å½“å‰æ—¥æœŸï¼‰
                const dateStr = new Date().toISOString().split('T')[0];
                const fullFileName = `${fileName}_${dateStr}.xlsx`;
                
                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fullFileName);
                
                return true;
            } catch (error) {
                console.error("å¯¼å‡ºExcelæ—¶å‡ºé”™:", error);
                return false;
            }
        }
        
        // è·å–å½“å‰æ˜¾ç¤ºçš„è¯æ±‡æ•°æ®
        function getCurrentDisplayData() {
            const scene = document.querySelector(".scene-btn.active").dataset.scene;
            const searchTerm = document.getElementById("searchInput").value;
            
            let filteredData = vocabularyData;
            
            // æ ¹æ®åœºæ™¯ç­›é€‰
            if (scene !== "all") {
                filteredData = vocabularyData.filter(item => item.scene === scene);
            }
            
            // æ ¹æ®æœç´¢è¯ç­›é€‰
            if (searchTerm) {
                filteredData = filteredData.map(scene => {
                    const filteredSubcategories = scene.subcategories.map(subcategory => {
                        const filteredItems = subcategory.items.filter(item => 
                            item.english.toLowerCase().includes(searchTerm.toLowerCase()) || 
                            item.chinese.toLowerCase().includes(searchTerm.toLowerCase()) ||
                            (item.phonetic && item.phonetic.toLowerCase().includes(searchTerm.toLowerCase()))
                        );
                        
                        return filteredItems.length > 0 ? {...subcategory, items: filteredItems} : null;
                    }).filter(subcategory => subcategory !== null);
                    
                    return filteredSubcategories.length > 0 ? {...scene, subcategories: filteredSubcategories} : null;
                }).filter(scene => scene !== null);
            }
            
            return filteredData;
        }
        
        // æ›´æ–°å¯¼å‡ºçŠ¶æ€
        function updateExportStatus(message, isSuccess = true) {
            const statusEl = document.getElementById("exportStatus");
            statusEl.textContent = message;
            statusEl.style.color = isSuccess ? "#4CAF50" : "#f44336";
            
            // 3ç§’åæ¸…é™¤çŠ¶æ€
            setTimeout(() => {
                statusEl.textContent = "";
            }, 3000);
        }
        
        // å¿«é€Ÿå¼€å§‹ - åˆ›å»ºç¤ºä¾‹åœºæ™¯
        function quickStartExample() {
            // åˆ›å»ºæ ¡å›­å­¦ä¹ åœºæ™¯
            addNewScene("æ ¡å›­å­¦ä¹ ", "ä¸å­¦æ ¡ã€è¯¾ç¨‹å’Œå­¦ä¹ ç›¸å…³çš„è¯æ±‡", "#1e88e5");
            
            // ç»™ç¬¬ä¸€ä¸ªåœºæ™¯æ·»åŠ åˆ†ç±»
            const firstScene = vocabularyData[0];
            if (firstScene) {
                addNewCategory(firstScene.scene, "è¯¾ç¨‹ä¸å­¦ä¸š");
                
                // ç»™ç¬¬ä¸€ä¸ªåˆ†ç±»æ·»åŠ ç¤ºä¾‹è¯æ±‡
                const firstCategory = firstScene.subcategories[0];
                if (firstCategory) {
                    const exampleVocabs = [
                        {english: "lecture", phonetic: "/ËˆlekÊ§É™r/", chinese: "è®²åº§"},
                        {english: "seminar", phonetic: "/ËˆsemÉªnÉ‘Ër/", chinese: "ç ”è®¨ä¼š"},
                        {english: "assignment", phonetic: "/É™ËˆsaÉªnmÉ™nt/", chinese: "ä½œä¸š"},
                        {english: "deadline", phonetic: "/ËˆdedlaÉªn/", chinese: "æˆªæ­¢æ—¥æœŸ"},
                        {english: "presentation", phonetic: "/ËŒpreznËˆteÉªÊƒn/", chinese: "è¯¾å ‚å±•ç¤º"}
                    ];
                    
                    exampleVocabs.forEach(vocab => {
                        addNewVocab(firstScene.scene, firstCategory.name, vocab.english, vocab.phonetic, vocab.chinese);
                    });
                }
            }
            
            updateCustomStatus("å·²åˆ›å»ºç¤ºä¾‹åœºæ™¯å’Œè¯æ±‡ï¼æ‚¨å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šç»§ç»­æ·»åŠ å†…å®¹ã€‚");
        }
        
        // ==================== æ–‡ä»¶å¯¼å…¥åŠŸèƒ½ ====================
        
        // æ˜¾ç¤ºæ–‡ä»¶å¯¼å…¥æ¨¡æ€æ¡†
        function showImportFileModal() {
            // é‡ç½®å¯¼å…¥ç»“æœ
            document.getElementById('importResults').style.display = 'none';
            document.getElementById('importProgress').style.display = 'none';
            
            // è®¾ç½®å¯¼å…¥æ¨¡å¼é€‰é¡¹æ ·å¼
            document.querySelectorAll('.import-mode-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.import-mode-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    const radio = this.querySelector('input[type="radio"]');
                    if (radio) radio.checked = true;
                });
            });
            
            // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªé€‰é¡¹
            document.querySelector('.import-mode-option').classList.add('selected');
            
            showModal('importFileModal');
        }
        
        // è§£æExcelæ–‡ä»¶
        function parseExcelFile(file, importMode) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        
                        // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        
                        // å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSON
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                        
                        // æ£€æŸ¥æ•°æ®æ ¼å¼
                        if (jsonData.length < 2) {
                            reject(new Error('Excelæ–‡ä»¶æ•°æ®ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®'));
                            return;
                        }
                        
                        // è·å–è¡¨å¤´
                        const headers = jsonData[0].map(h => h ? h.toString().trim() : '');
                        
                        // æ£€æŸ¥å¿…è¦çš„åˆ—
                        const requiredColumns = ['åœºæ™¯', 'åˆ†ç±»', 'è‹±æ–‡', 'ä¸­æ–‡'];
                        const missingColumns = requiredColumns.filter(col => !headers.includes(col));
                        
                        if (missingColumns.length > 0) {
                            reject(new Error(`Excelæ–‡ä»¶ç¼ºå°‘å¿…è¦çš„åˆ—ï¼š${missingColumns.join(', ')}ã€‚éœ€è¦çš„åˆ—åŒ…æ‹¬ï¼šåœºæ™¯ã€åˆ†ç±»ã€è‹±æ–‡ã€éŸ³æ ‡ã€ä¸­æ–‡`));
                            return;
                        }
                        
                        // è·å–åˆ—ç´¢å¼•
                        const sceneIndex = headers.indexOf('åœºæ™¯');
                        const categoryIndex = headers.indexOf('åˆ†ç±»');
                        const englishIndex = headers.indexOf('è‹±æ–‡');
                        const phoneticIndex = headers.includes('éŸ³æ ‡') ? headers.indexOf('éŸ³æ ‡') : -1;
                        const chineseIndex = headers.indexOf('ä¸­æ–‡');
                        
                        // å¤„ç†æ•°æ®è¡Œ
                        const importedData = [];
                        const sceneMap = new Map(); // ç”¨äºåˆå¹¶ç›¸åŒåœºæ™¯
                        
                        for (let i = 1; i < jsonData.length; i++) {
                            const row = jsonData[i];
                            if (!row || row.length === 0) continue;
                            
                            const sceneName = row[sceneIndex] ? row[sceneIndex].toString().trim() : '';
                            const categoryName = row[categoryIndex] ? row[categoryIndex].toString().trim() : '';
                            const english = row[englishIndex] ? row[englishIndex].toString().trim() : '';
                            const phonetic = phoneticIndex >= 0 && row[phoneticIndex] ? row[phoneticIndex].toString().trim() : '';
                            const chinese = row[chineseIndex] ? row[chineseIndex].toString().trim() : '';
                            
                            if (!sceneName || !categoryName || !english || !chinese) {
                                console.warn(`ç¬¬${i+1}è¡Œæ•°æ®ä¸å®Œæ•´ï¼Œå·²è·³è¿‡`);
                                continue;
                            }
                            
                            // ç”Ÿæˆåœºæ™¯ID
                            const sceneId = generateSceneId(sceneName);
                            
                            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥åœºæ™¯
                            if (!sceneMap.has(sceneId)) {
                                sceneMap.set(sceneId, {
                                    scene: sceneId,
                                    title: sceneName,
                                    description: `ä»Excelæ–‡ä»¶å¯¼å…¥çš„åœºæ™¯ï¼š${sceneName}`,
                                    color: getRandomColor(),
                                    subcategories: new Map()
                                });
                            }
                            
                            const scene = sceneMap.get(sceneId);
                            
                            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥åˆ†ç±»
                            if (!scene.subcategories.has(categoryName)) {
                                scene.subcategories.set(categoryName, {
                                    name: categoryName,
                                    items: []
                                });
                            }
                            
                            const category = scene.subcategories.get(categoryName);
                            
                            // æ·»åŠ è¯æ±‡
                            category.items.push({
                                id: generateId(),
                                english: english,
                                phonetic: phonetic,
                                chinese: chinese
                            });
                        }
                        
                        // è½¬æ¢ä¸ºæ•°ç»„æ ¼å¼
                        const result = Array.from(sceneMap.values()).map(scene => ({
                            ...scene,
                            subcategories: Array.from(scene.subcategories.values())
                        }));
                        
                        resolve(result);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }
        
        // è§£æJSONæ–‡ä»¶
        function parseJsonFile(file, importMode) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        
                        if (!Array.isArray(jsonData)) {
                            reject(new Error('JSONæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸ºæ•°ç»„'));
                            return;
                        }
                        
                        // è½¬æ¢æ•°æ®æ ¼å¼
                        const importedData = jsonData.map(scene => {
                            // ç”Ÿæˆæ–°çš„åœºæ™¯IDä»¥é¿å…å†²çª
                            const sceneId = generateSceneId(scene.title || scene.scene);
                            
                            return {
                                scene: sceneId,
                                title: scene.title || scene.scene,
                                description: scene.description || '',
                                color: scene.color || getRandomColor(),
                                subcategories: scene.subcategories ? scene.subcategories.map(category => ({
                                    name: category.name,
                                    items: category.items ? category.items.map(item => ({
                                        id: generateId(),
                                        english: item.english,
                                        phonetic: item.phonetic || '',
                                        chinese: item.chinese
                                    })) : []
                                })) : []
                            };
                        });
                        
                        resolve(importedData);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
                };
                
                reader.readAsText(file);
            });
        }
        
        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = [
                '#e91e63', '#ff9800', '#4CAF50', '#2196F3', 
                '#9c27b0', '#00bcd4', '#1e88e5', '#43a047'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // æ˜¾ç¤ºå¯¼å…¥è¿›åº¦
        function showImportProgress(percent, message) {
            const progressEl = document.getElementById('importProgress');
            const progressFill = document.getElementById('importProgressFill');
            const progressText = document.getElementById('importProgressText');
            
            progressEl.style.display = 'block';
            progressFill.style.width = `${percent}%`;
            progressText.textContent = message;
        }
        
        // æ˜¾ç¤ºå¯¼å…¥ç»“æœ
        function showImportResults(results) {
            const resultsEl = document.getElementById('importResults');
            const statsEl = document.getElementById('importResultStats');
            const detailsEl = document.getElementById('importResultDetails');
            
            // æ›´æ–°ç»Ÿè®¡
            statsEl.innerHTML = `
                <div class="result-stat">
                    <div class="result-number">${results.scenes}</div>
                    <div class="result-label">åœºæ™¯</div>
                </div>
                <div class="result-stat">
                    <div class="result-number">${results.categories}</div>
                    <div class="result-label">åˆ†ç±»</div>
                </div>
                <div class="result-stat">
                    <div class="result-number">${results.words}</div>
                    <div class="result-label">è¯æ±‡</div>
                </div>
            `;
            
            // æ›´æ–°è¯¦æƒ…
            let detailsHTML = '<ul>';
            if (results.sceneDetails && results.sceneDetails.length > 0) {
                results.sceneDetails.forEach(detail => {
                    detailsHTML += `<li>${detail}</li>`;
                });
            } else {
                detailsHTML += '<li>æ— è¯¦ç»†æ•°æ®</li>';
            }
            detailsHTML += '</ul>';
            
            detailsEl.innerHTML = detailsHTML;
            resultsEl.style.display = 'block';
        }
        
        // å¤„ç†æ–‡ä»¶å¯¼å…¥
        async function handleFileImport(file, type, importMode) {
            try {
                showImportProgress(10, 'å¼€å§‹è§£ææ–‡ä»¶...');
                
                let importedData;
                
                if (type === 'excel') {
                    showImportProgress(30, 'è§£æExcelæ–‡ä»¶...');
                    importedData = await parseExcelFile(file, importMode);
                } else if (type === 'json') {
                    showImportProgress(30, 'è§£æJSONæ–‡ä»¶...');
                    importedData = await parseJsonFile(file, importMode);
                } else {
                    throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹');
                }
                
                showImportProgress(60, 'å¤„ç†å¯¼å…¥æ•°æ®...');
                
                // ç»Ÿè®¡å¯¼å…¥æ•°æ®
                let totalScenes = importedData.length;
                let totalCategories = 0;
                let totalWords = 0;
                const sceneDetails = [];
                
                importedData.forEach(scene => {
                    const sceneCategories = scene.subcategories.length;
                    const sceneWords = scene.subcategories.reduce((sum, cat) => sum + cat.items.length, 0);
                    
                    totalCategories += sceneCategories;
                    totalWords += sceneWords;
                    
                    sceneDetails.push(`${scene.title}: ${sceneCategories}ä¸ªåˆ†ç±», ${sceneWords}ä¸ªè¯æ±‡`);
                });
                
                // æ ¹æ®å¯¼å…¥æ¨¡å¼å¤„ç†æ•°æ®
                if (importMode === 'replace') {
                    // æ›¿æ¢æ¨¡å¼ï¼šæ¸…ç©ºç°æœ‰æ•°æ®
                    vocabularyData = importedData;
                } else {
                    // åˆå¹¶æ¨¡å¼ï¼šåˆå¹¶æ•°æ®
                    // å…ˆå¤åˆ¶ç°æœ‰æ•°æ®
                    const existingData = [...vocabularyData];
                    
                    // å¯¹äºæ¯ä¸ªå¯¼å…¥çš„åœºæ™¯ï¼Œæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                    importedData.forEach(importedScene => {
                        const existingSceneIndex = existingData.findIndex(scene => scene.scene === importedScene.scene);
                        
                        if (existingSceneIndex !== -1) {
                            // åœºæ™¯å·²å­˜åœ¨ï¼Œåˆå¹¶åˆ†ç±»
                            const existingScene = existingData[existingSceneIndex];
                            
                            importedScene.subcategories.forEach(importedCategory => {
                                const existingCategoryIndex = existingScene.subcategories.findIndex(cat => cat.name === importedCategory.name);
                                
                                if (existingCategoryIndex !== -1) {
                                    // åˆ†ç±»å·²å­˜åœ¨ï¼Œåˆå¹¶è¯æ±‡
                                    const existingCategory = existingScene.subcategories[existingCategoryIndex];
                                    
                                    // æ·»åŠ ä¸é‡å¤çš„è¯æ±‡
                                    importedCategory.items.forEach(importedItem => {
                                        const existingItemIndex = existingCategory.items.findIndex(item => 
                                            item.english === importedItem.english && item.chinese === importedItem.chinese
                                        );
                                        
                                        if (existingItemIndex === -1) {
                                            existingCategory.items.push(importedItem);
                                        }
                                    });
                                } else {
                                    // åˆ†ç±»ä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°åˆ†ç±»
                                    existingScene.subcategories.push(importedCategory);
                                }
                            });
                        } else {
                            // åœºæ™¯ä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°åœºæ™¯
                            existingData.push(importedScene);
                        }
                    });
                    
                    vocabularyData = existingData;
                }
                
                // æ›´æ–°IDè®¡æ•°å™¨
                updateIdCounter();
                
                // ä¿å­˜åˆ°localStorage
                saveCustomData();
                
                showImportProgress(90, 'æ›´æ–°ç•Œé¢...');
                
                // æ›´æ–°UI
                updateSceneFilterButtons();
                updateStatistics();
                
                // é‡æ–°æ¸²æŸ“
                const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
                const searchTerm = document.getElementById("searchInput").value;
                renderVocabulary(activeScene, searchTerm);
                
                // æ›´æ–°åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
                populateSceneSelect('categoryScene');
                populateSceneSelect('vocabScene');
                populateSceneSelect('batchScene');
                
                showImportProgress(100, 'å¯¼å…¥å®Œæˆï¼');
                
                // æ˜¾ç¤ºç»“æœ
                showImportResults({
                    scenes: totalScenes,
                    categories: totalCategories,
                    words: totalWords,
                    sceneDetails: sceneDetails
                });
                
                updateCustomStatus(`æˆåŠŸå¯¼å…¥ ${totalScenes} ä¸ªåœºæ™¯, ${totalCategories} ä¸ªåˆ†ç±», ${totalWords} ä¸ªè¯æ±‡ï¼`);
                
            } catch (error) {
                console.error('å¯¼å…¥å¤±è´¥:', error);
                showImportProgress(0, 'å¯¼å…¥å¤±è´¥');
                updateCustomStatus(`å¯¼å…¥å¤±è´¥: ${error.message}`, false);
            }
        }
        
        // ==================== PWAæ·»åŠ åˆ°ä¸»å±å¹•åŠŸèƒ½ ====================
        
        // æ£€æµ‹æ˜¯å¦æ”¯æŒPWA
        function checkPWAInstall() {
            // æ£€æµ‹æ˜¯å¦åœ¨ç§»åŠ¨ç«¯
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // æ£€æµ‹æ˜¯å¦æ”¯æŒæ·»åŠ åˆ°ä¸»å±å¹•
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            
            if (isMobile && !isStandalone) {
                // æ˜¾ç¤ºæ·»åŠ åˆ°ä¸»å±å¹•æŒ‰é’®
                const pwaBtn = document.getElementById('pwaInstallBtn');
                pwaBtn.style.display = 'flex';
                
                pwaBtn.addEventListener('click', function() {
                    showPWAInstallPrompt();
                });
            }
        }
        
        // æ˜¾ç¤ºPWAå®‰è£…æç¤º
        function showPWAInstallPrompt() {
            alert('è¦æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n\n' +
                  '1. ç‚¹å‡»æµè§ˆå™¨èœå•æŒ‰é’®ï¼ˆé€šå¸¸æ˜¯ä¸‰ä¸ªç‚¹ï¼‰\n' +
                  '2. é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"æˆ–"å®‰è£…åº”ç”¨"\n' +
                  '3. æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…\n\n' +
                  'å®‰è£…åï¼Œæ‚¨å¯ä»¥åƒä½¿ç”¨æ™®é€šAppä¸€æ ·ä½¿ç”¨æœ¬ç³»ç»Ÿã€‚');
        }
        
        // ==================== åˆå§‹åŒ–é¡µé¢ ====================
        
        document.addEventListener("DOMContentLoaded", function() {
            // ä»localStorageåŠ è½½è‡ªå®šä¹‰æ•°æ®
            loadCustomData();
            
            // æ›´æ–°IDè®¡æ•°å™¨
            updateIdCounter();
            
            // æ£€æŸ¥æµè§ˆå™¨è¯­éŸ³æ”¯æŒ
            checkSpeechSupport();
            
            // æ£€æŸ¥PWAå®‰è£…æ”¯æŒ
            checkPWAInstall();
            
            // åˆå§‹æ¸²æŸ“æ‰€æœ‰è¯æ±‡
            renderVocabulary();
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateStatistics();
            
            // æ›´æ–°åœºæ™¯ç­›é€‰æŒ‰é’®
            updateSceneFilterButtons();
            
            // å¡«å……åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
            populateSceneSelect('categoryScene');
            populateSceneSelect('vocabScene');
            populateSceneSelect('batchScene');
            
            // åœºæ™¯é€‰æ‹©å˜åŒ–æ—¶ï¼Œæ›´æ–°åˆ†ç±»é€‰æ‹©ä¸‹æ‹‰æ¡†
            document.getElementById('categoryScene').addEventListener('change', function() {
                populateCategorySelect(this.value, 'vocabCategory');
            });
            
            document.getElementById('vocabScene').addEventListener('change', function() {
                populateCategorySelect(this.value, 'vocabCategory');
            });
            
            document.getElementById('batchScene').addEventListener('change', function() {
                populateCategorySelect(this.value, 'batchCategory');
            });
            
            // æœç´¢æ¡†äº‹ä»¶
            const searchInput = document.getElementById("searchInput");
            let searchTimer;
            
            searchInput.addEventListener("input", function() {
                clearTimeout(searchTimer);
                
                searchTimer = setTimeout(() => {
                    const scene = document.querySelector(".scene-btn.active").dataset.scene;
                    renderVocabulary(scene, this.value);
                }, 300);
            });
            
            // å¯¼å‡ºå…¨éƒ¨è¯æ±‡æŒ‰é’®äº‹ä»¶
            document.getElementById("exportAllBtn").addEventListener("click", function() {
                if (vocabularyData.length === 0) {
                    updateExportStatus("æ²¡æœ‰è¯æ±‡å¯ä»¥å¯¼å‡º", false);
                    return;
                }
                
                const success = exportToExcel(vocabularyData, "å¬åŠ›è¯æ±‡_å…¨éƒ¨");
                if (success) {
                    updateExportStatus("âœ“ å…¨éƒ¨è¯æ±‡å·²æˆåŠŸå¯¼å‡ºä¸ºExcelæ–‡ä»¶ï¼");
                } else {
                    updateExportStatus("âœ— å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•", false);
                }
            });
            
            // å¯¼å‡ºå½“å‰æ˜¾ç¤ºè¯æ±‡æŒ‰é’®äº‹ä»¶
            document.getElementById("exportCurrentBtn").addEventListener("click", function() {
                const currentData = getCurrentDisplayData();
                if (currentData.length === 0) {
                    updateExportStatus("âœ— æ²¡æœ‰è¯æ±‡å¯ä»¥å¯¼å‡º", false);
                    return;
                }
                
                const scene = document.querySelector(".scene-btn.active").dataset.scene;
                const searchTerm = document.getElementById("searchInput").value;
                let fileName = "å¬åŠ›è¯æ±‡";
                
                if (scene !== "all") {
                    const sceneName = document.querySelector(".scene-btn.active").textContent;
                    fileName += `_${sceneName}`;
                }
                
                if (searchTerm) {
                    fileName += `_æœç´¢"${searchTerm}"`;
                }
                
                const success = exportToExcel(currentData, fileName);
                if (success) {
                    updateExportStatus("âœ“ å½“å‰æ˜¾ç¤ºè¯æ±‡å·²æˆåŠŸå¯¼å‡ºä¸ºExcelæ–‡ä»¶ï¼");
                } else {
                    updateExportStatus("âœ— å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•", false);
                }
            });
            
            // ç‚¹è¯»åŠŸèƒ½ï¼šç‚¹å‡»å•è¯æœ—è¯»
            document.addEventListener("click", function(e) {
                // ç‚¹å‡»å•è¯æœ—è¯»
                if (e.target.classList.contains("vocab-english") || 
                    e.target.classList.contains("speak-icon")) {
                    
                    const vocabItem = e.target.closest(".vocab-english");
                    if (vocabItem) {
                        // è·å–å•è¯æ–‡æœ¬ï¼ˆå»é™¤HTMLæ ‡ç­¾ï¼‰
                        const word = vocabItem.textContent.replace(/<[^>]*>/g, '').trim();
                        
                        // å¦‚æœæ­£åœ¨æ‰¹é‡æœ—è¯»ï¼Œå…ˆåœæ­¢
                        if (isSpeaking) {
                            stopSpeaking();
                        }
                        
                        // æœ—è¯»å•è¯
                        speakWord(word, vocabItem);
                        updateSpeechStatus(`æœ—è¯»å•è¯: ${word}`);
                    }
                }
                
                // ç‚¹å‡»å…¶ä»–éƒ¨åˆ†æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                if (e.target.classList.contains("vocab-phonetic") || 
                    e.target.classList.contains("vocab-chinese")) {
                    
                    const vocabItem = e.target.closest(".vocab-item");
                    if (vocabItem) {
                        const english = vocabItem.querySelector(".vocab-english").textContent.replace(/<[^>]*>/g, '').trim();
                        const phonetic = vocabItem.querySelector(".vocab-phonetic").textContent.replace(/<[^>]*>/g, '').trim();
                        const chinese = vocabItem.querySelector(".vocab-chinese").textContent.replace(/<[^>]*>/g, '').trim();
                        
                        // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                        alert(`è¯æ±‡è¯¦æƒ…ï¼š\n\nè‹±æ–‡ï¼š${english}\néŸ³æ ‡ï¼š${phonetic}\nä¸­æ–‡ï¼š${chinese}`);
                    }
                }
            });
            
            // æœ—è¯»å…¨éƒ¨æ˜¾ç¤ºå•è¯æŒ‰é’®äº‹ä»¶
            document.getElementById("speakAllBtn").addEventListener("click", function() {
                if (!speechSynthesis) {
                    updateSpeechStatus("æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½", false);
                    return;
                }
                
                const words = getAllDisplayedWords();
                startBatchSpeaking(words);
            });
            
            // æœ—è¯»å½“å‰åœºæ™¯æŒ‰é’®äº‹ä»¶
            document.getElementById("speakCurrentBtn").addEventListener("click", function() {
                if (!speechSynthesis) {
                    updateSpeechStatus("æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½", false);
                    return;
                }
                
                const words = getCurrentSceneWords();
                startBatchSpeaking(words);
            });
            
            // åœæ­¢æœ—è¯»æŒ‰é’®äº‹ä»¶
            document.getElementById("stopSpeakBtn").addEventListener("click", function() {
                stopSpeaking();
            });
            
            // è¯­éŸ³è®¾ç½®å˜åŒ–æ—¶ï¼Œå¦‚æœæ­£åœ¨æœ—è¯»ï¼Œæ›´æ–°å½“å‰è¯­éŸ³è®¾ç½®
            document.getElementById("speechRate").addEventListener("change", function() {
                if (currentUtterance && speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    currentUtterance.rate = parseFloat(this.value);
                    speechSynthesis.speak(currentUtterance);
                }
            });
            
            document.getElementById("speechPitch").addEventListener("change", function() {
                if (currentUtterance && speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    currentUtterance.pitch = parseFloat(this.value);
                    speechSynthesis.speak(currentUtterance);
                }
            });
            
            document.getElementById("speechVolume").addEventListener("input", function() {
                if (currentUtterance && speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    currentUtterance.volume = parseFloat(this.value);
                    speechSynthesis.speak(currentUtterance);
                }
            });
            
            // è‡ªå®šä¹‰è¯æ±‡ç®¡ç†æŒ‰é’®äº‹ä»¶
            document.getElementById("addSceneBtn").addEventListener("click", function() {
                showModal('addSceneModal');
            });
            
            document.getElementById("addCategoryBtn").addEventListener("click", function() {
                populateSceneSelect('categoryScene');
                showModal('addCategoryModal');
            });
            
            document.getElementById("addVocabBtn").addEventListener("click", function() {
                populateSceneSelect('vocabScene');
                if (document.getElementById('vocabScene').options.length > 0) {
                    const firstScene = document.getElementById('vocabScene').options[0].value;
                    populateCategorySelect(firstScene, 'vocabCategory');
                }
                showModal('addVocabModal');
            });
            
            document.getElementById("batchAddBtn").addEventListener("click", function() {
                populateSceneSelect('batchScene');
                if (document.getElementById('batchScene').options.length > 0) {
                    const firstScene = document.getElementById('batchScene').options[0].value;
                    populateCategorySelect(firstScene, 'batchCategory');
                }
                showModal('batchAddModal');
            });
            
            document.getElementById("manageCustomBtn").addEventListener("click", function() {
                // æ›´æ–°è‡ªå®šä¹‰åœºæ™¯åˆ—è¡¨
                const customScenesList = document.getElementById('customScenesList');
                customScenesList.innerHTML = '';
                
                if (vocabularyData.length === 0) {
                    customScenesList.innerHTML = '<p style="color: #888; text-align: center;">æš‚æ— è‡ªå®šä¹‰åœºæ™¯</p>';
                } else {
                    vocabularyData.forEach(scene => {
                        const sceneDiv = document.createElement('div');
                        sceneDiv.style.cssText = 'padding: 10px; border: 1px solid #f0f4ff; border-radius: 8px; margin-bottom: 10px;';
                        sceneDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${scene.title}</strong>
                                    <div style="font-size: 0.85rem; color: #666;">
                                        åˆ†ç±»: ${scene.subcategories.length} ä¸ª, è¯æ±‡: ${scene.subcategories.reduce((sum, cat) => sum + cat.items.length, 0)} ä¸ª
                                    </div>
                                </div>
                                <button class="btn btn-danger delete-scene-btn-modal" data-scene="${scene.scene}" style="padding: 5px 10px; font-size: 0.9rem;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                        customScenesList.appendChild(sceneDiv);
                    });
                }
                
                showModal('manageCustomModal');
            });
            
            // æ–‡ä»¶å¯¼å…¥æŒ‰é’®äº‹ä»¶
            document.getElementById("importFileBtn").addEventListener("click", function() {
                showImportFileModal();
            });
            
            // Excelå¯¼å…¥æŒ‰é’®äº‹ä»¶
            document.getElementById("importExcelBtn").addEventListener("click", function() {
                document.getElementById('importExcelInput').click();
            });
            
            // JSONå¯¼å…¥æŒ‰é’®äº‹ä»¶
            document.getElementById("importJsonBtn").addEventListener("click", function() {
                document.getElementById('importJsonInput').click();
            });
            
            // å¿«é€Ÿå¼€å§‹æŒ‰é’®äº‹ä»¶
            document.getElementById("quickStartBtn").addEventListener("click", function() {
                quickStartExample();
            });
            
            // æ¨¡æ€æ¡†å…³é—­æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.modal-close, .btn-secondary[data-modal]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.dataset.modal;
                    hideModal(modalId);
                });
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        const modalId = this.id;
                        hideModal(modalId);
                    }
                });
            });
            
            // æ·»åŠ åœºæ™¯è¡¨å•æäº¤
            document.getElementById('addSceneForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const sceneName = document.getElementById('sceneName').value.trim();
                const sceneDescription = document.getElementById('sceneDescription').value.trim();
                const sceneColor = document.getElementById('sceneColor').value;
                
                if (!sceneName) {
                    updateCustomStatus("è¯·è¾“å…¥åœºæ™¯åç§°", false);
                    return;
                }
                
                const success = addNewScene(sceneName, sceneDescription, sceneColor);
                if (success) {
                    updateCustomStatus("åœºæ™¯æ·»åŠ æˆåŠŸï¼");
                    this.reset();
                    hideModal('addSceneModal');
                }
            });
            
            // æ·»åŠ åˆ†ç±»è¡¨å•æäº¤
            document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const sceneId = document.getElementById('categoryScene').value;
                const categoryName = document.getElementById('categoryName').value.trim();
                
                if (!categoryName) {
                    updateCustomStatus("è¯·è¾“å…¥åˆ†ç±»åç§°", false);
                    return;
                }
                
                const success = addNewCategory(sceneId, categoryName);
                if (success) {
                    updateCustomStatus("åˆ†ç±»æ·»åŠ æˆåŠŸï¼");
                    this.reset();
                    hideModal('addCategoryModal');
                }
            });
            
            // æ·»åŠ è¯æ±‡è¡¨å•æäº¤
            document.getElementById('addVocabForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const sceneId = document.getElementById('vocabScene').value;
                const categoryName = document.getElementById('vocabCategory').value;
                const english = document.getElementById('vocabEnglish').value.trim();
                const phonetic = document.getElementById('vocabPhonetic').value.trim();
                const chinese = document.getElementById('vocabChinese').value.trim();
                
                if (!english || !chinese) {
                    updateCustomStatus("è¯·å¡«å†™è‹±æ–‡å’Œä¸­æ–‡é‡Šä¹‰", false);
                    return;
                }
                
                const success = addNewVocab(sceneId, categoryName, english, phonetic, chinese);
                if (success) {
                    updateCustomStatus("è¯æ±‡æ·»åŠ æˆåŠŸï¼");
                    this.reset();
                    hideModal('addVocabModal');
                }
            });
            
            // æ‰¹é‡æ·»åŠ è¡¨å•æäº¤
            document.getElementById('batchAddForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const sceneId = document.getElementById('batchScene').value;
                const categoryName = document.getElementById('batchCategory').value;
                const content = document.getElementById('batchContent').value.trim();
                
                if (!content) {
                    updateCustomStatus("è¯·è¾“å…¥è¯æ±‡å†…å®¹", false);
                    return;
                }
                
                const success = batchAddVocab(sceneId, categoryName, content);
                if (success) {
                    this.reset();
                    hideModal('batchAddModal');
                }
            });
            
            // ç¼–è¾‘è¯æ±‡è¡¨å•æäº¤
            document.getElementById('editVocabForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const vocabId = document.getElementById('editVocabId').value;
                const english = document.getElementById('editVocabEnglish').value.trim();
                const phonetic = document.getElementById('editVocabPhonetic').value.trim();
                const chinese = document.getElementById('editVocabChinese').value.trim();
                
                if (!english || !chinese) {
                    updateCustomStatus("è¯·å¡«å†™è‹±æ–‡å’Œä¸­æ–‡é‡Šä¹‰", false);
                    return;
                }
                
                const success = editVocab(vocabId, english, phonetic, chinese);
                if (success) {
                    updateCustomStatus("è¯æ±‡ç¼–è¾‘æˆåŠŸï¼");
                    this.reset();
                    hideModal('editVocabModal');
                }
            });
            
            // æ‰¹é‡æ·»åŠ æ¨¡æ¿æŒ‰é’®
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const template = this.dataset.template;
                    let content = '';
                    
                    switch(template) {
                        case 'campus':
                            content = `lecture /ËˆlekÊ§É™r/ è®²åº§
seminar /ËˆsemÉªnÉ‘Ër/ ç ”è®¨ä¼š
assignment /É™ËˆsaÉªnmÉ™nt/ ä½œä¸š
deadline /ËˆdedlaÉªn/ æˆªæ­¢æ—¥æœŸ
presentation /ËŒpreznËˆteÉªÊƒn/ è¯¾å ‚å±•ç¤º
professor /prÉ™ËˆfesÉ™r/ æ•™æˆ
library /ËˆlaÉªbreri/ å›¾ä¹¦é¦†
cafeteria /ËŒkÃ¦fÉ™ËˆtÉªriÉ™/ é£Ÿå ‚
scholarship /ËˆskÉ‘ËlÉ™rÊƒÉªp/ å¥–å­¦é‡‘
tuition /tuËˆÉªÊƒn/ å­¦è´¹`;
                            break;
                        case 'daily':
                            content = `menu /ËˆmenjuË/ èœå•
order /ËˆÉ”ËrdÉ™r/ ç‚¹é¤
discount /ËˆdÉªskaÊŠnt/ æŠ˜æ‰£
receipt /rÉªËˆsiËt/ æ”¶æ®
refund /ËˆriËfÊŒnd/ é€€æ¬¾
delay /dÉªËˆleÉª/ å»¶è¯¯
traffic jam /ËˆtrÃ¦fÉªk/ /dÊ’Ã¦m/ äº¤é€šå µå¡
flight /flaÉªt/ èˆªç­
terminal /ËˆtÉœËrmÉªnl/ èˆªç«™æ¥¼
subway /ËˆsÊŒbweÉª/ åœ°é“`;
                            break;
                        case 'travel':
                            content = `passport /ËˆpÃ¦spÉ”Ërt/ æŠ¤ç…§
visa /ËˆviËzÉ™/ ç­¾è¯
itinerary /aÉªËˆtÉªnÉ™reri/ æ—…è¡Œæ—¥ç¨‹
boarding pass /ËˆbÉ”ËrdÉªÅ‹/ /pÃ¦s/ ç™»æœºç‰Œ
souvenir /ËŒsuËvÉ™ËˆnÉªr/ çºªå¿µå“
scenic spot /ËˆsiËnÉªk/ /spÉ‘Ët/ æ™¯ç‚¹
guided tour /ËˆÉ¡aÉªdÉªd/ /tÊŠr/ æœ‰å¯¼æ¸¸çš„æ¸¸è§ˆ
rental car /Ëˆrentl/ /kÉ‘Ër/ ç§Ÿèµæ±½è½¦
check in /tÊƒek/ /Éªn/ åŠç†ç™»æœº/å…¥ä½
cancel /ËˆkÃ¦nsl/ å–æ¶ˆ`;
                            break;
                    }
                    
                    document.getElementById('batchContent').value = content;
                });
            });
            
            // æ–‡ä»¶è¾“å…¥äº‹ä»¶å¤„ç†
            document.getElementById('importExcelInput').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const importMode = document.querySelector('input[name="importMode"]:checked').value;
                
                await handleFileImport(file, 'excel', importMode);
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                this.value = '';
            });
            
            document.getElementById('importJsonInput').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const importMode = document.querySelector('input[name="importMode"]:checked').value;
                
                await handleFileImport(file, 'json', importMode);
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                this.value = '';
            });
            
            // äº‹ä»¶å§”æ‰˜ï¼šå¤„ç†åŠ¨æ€ç”Ÿæˆçš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            document.addEventListener('click', function(e) {
                // åˆ é™¤è¯æ±‡æŒ‰é’®
                if (e.target.closest('.delete-vocab-btn')) {
                    const btn = e.target.closest('.delete-vocab-btn');
                    const vocabId = btn.dataset.id;
                    
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè¯æ±‡å—ï¼Ÿ')) {
                        const success = deleteVocab(vocabId);
                        if (success) {
                            updateCustomStatus("è¯æ±‡åˆ é™¤æˆåŠŸï¼");
                        }
                    }
                }
                
                // ç¼–è¾‘è¯æ±‡æŒ‰é’®
                else if (e.target.closest('.edit-vocab-btn')) {
                    const btn = e.target.closest('.edit-vocab-btn');
                    const vocabId = btn.dataset.id;
                    
                    // æŸ¥æ‰¾è¯æ±‡ä¿¡æ¯
                    let vocabInfo = null;
                    for (let scene of vocabularyData) {
                        for (let category of scene.subcategories) {
                            const vocab = category.items.find(item => item.id === vocabId);
                            if (vocab) {
                                vocabInfo = vocab;
                                break;
                            }
                        }
                        if (vocabInfo) break;
                    }
                    
                    if (vocabInfo) {
                        document.getElementById('editVocabId').value = vocabId;
                        document.getElementById('editVocabEnglish').value = vocabInfo.english;
                        document.getElementById('editVocabPhonetic').value = vocabInfo.phonetic || '';
                        document.getElementById('editVocabChinese').value = vocabInfo.chinese;
                        showModal('editVocabModal');
                    }
                }
                
                // åˆ é™¤åˆ†ç±»æŒ‰é’®
                else if (e.target.closest('.delete-category-btn')) {
                    const btn = e.target.closest('.delete-category-btn');
                    const sceneId = btn.dataset.scene;
                    const categoryName = btn.dataset.category;
                    
                    if (confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç±»"${categoryName}"å—ï¼Ÿè¿™å°†åˆ é™¤è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰è¯æ±‡ï¼`)) {
                        const success = deleteCategory(sceneId, categoryName);
                        if (success) {
                            updateCustomStatus("åˆ†ç±»åˆ é™¤æˆåŠŸï¼");
                        }
                    }
                }
                
                // åˆ é™¤åœºæ™¯æŒ‰é’®ï¼ˆåœ¨åœºæ™¯å¡ç‰‡ä¸Šï¼‰
                else if (e.target.closest('.delete-scene-btn')) {
                    const btn = e.target.closest('.delete-scene-btn');
                    const sceneId = btn.dataset.scene;
                    
                    // æŸ¥æ‰¾åœºæ™¯åç§°
                    const scene = vocabularyData.find(s => s.scene === sceneId);
                    if (scene) {
                        if (confirm(`ç¡®å®šè¦åˆ é™¤åœºæ™¯"${scene.title}"å—ï¼Ÿè¿™å°†åˆ é™¤è¯¥åœºæ™¯ä¸‹çš„æ‰€æœ‰åˆ†ç±»å’Œè¯æ±‡ï¼`)) {
                            const success = deleteScene(sceneId);
                            if (success) {
                                updateCustomStatus("åœºæ™¯åˆ é™¤æˆåŠŸï¼");
                            }
                        }
                    }
                }
                
                // åˆ é™¤åœºæ™¯æŒ‰é’®ï¼ˆåœ¨ç®¡ç†æ¨¡æ€æ¡†ä¸­ï¼‰
                else if (e.target.closest('.delete-scene-btn-modal')) {
                    const btn = e.target.closest('.delete-scene-btn-modal');
                    const sceneId = btn.dataset.scene;
                    
                    // æŸ¥æ‰¾åœºæ™¯åç§°
                    const scene = vocabularyData.find(s => s.scene === sceneId);
                    if (scene) {
                        if (confirm(`ç¡®å®šè¦åˆ é™¤åœºæ™¯"${scene.title}"å—ï¼Ÿè¿™å°†åˆ é™¤è¯¥åœºæ™¯ä¸‹çš„æ‰€æœ‰åˆ†ç±»å’Œè¯æ±‡ï¼`)) {
                            const success = deleteScene(sceneId);
                            if (success) {
                                updateCustomStatus("åœºæ™¯åˆ é™¤æˆåŠŸï¼");
                                // é‡æ–°æ‰“å¼€ç®¡ç†æ¨¡æ€æ¡†ä»¥æ›´æ–°åˆ—è¡¨
                                document.getElementById('manageCustomBtn').click();
                            }
                        }
                    }
                }
            });
            
            // å¯¼å‡ºè‡ªå®šä¹‰å†…å®¹æŒ‰é’®
            document.getElementById('exportCustomBtn').addEventListener('click', function() {
                if (vocabularyData.length === 0) {
                    alert('æš‚æ— è‡ªå®šä¹‰å†…å®¹å¯å¯¼å‡º');
                    return;
                }
                
                const dataStr = JSON.stringify(vocabularyData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `custom_vocabulary_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                updateCustomStatus("è‡ªå®šä¹‰å†…å®¹å¯¼å‡ºæˆåŠŸï¼");
            });
            
            // å¯¼å…¥è‡ªå®šä¹‰å†…å®¹æŒ‰é’®
            document.getElementById('importCustomBtn').addEventListener('click', function() {
                document.getElementById('importFileInput').click();
            });
            
            // æ–‡ä»¶å¯¼å…¥å¤„ç†
            document.getElementById('importFileInput').addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // é»˜è®¤ä½¿ç”¨åˆå¹¶æ¨¡å¼
                await handleFileImport(file, 'json', 'merge');
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                this.value = '';
            });
            
            // é‡ç½®æ‰€æœ‰è‡ªå®šä¹‰å†…å®¹æŒ‰é’®
            document.getElementById('resetCustomBtn').addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰è‡ªå®šä¹‰å†…å®¹å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰åœºæ™¯ã€åˆ†ç±»å’Œè¯æ±‡ï¼Œæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                    // æ¸…ç©ºæ‰€æœ‰æ•°æ®
                    vocabularyData = [];
                    
                    // æ¸…é™¤localStorage
                    localStorage.removeItem('customVocabularyData');
                    
                    // é‡ç½®IDè®¡æ•°å™¨
                    vocabIdCounter = 1000;
                    
                    // æ›´æ–°UI
                    updateSceneFilterButtons();
                    updateStatistics();
                    
                    // é‡æ–°æ¸²æŸ“
                    const activeScene = document.querySelector(".scene-btn.active").dataset.scene;
                    const searchTerm = document.getElementById("searchInput").value;
                    renderVocabulary(activeScene, searchTerm);
                    
                    // æ›´æ–°åœºæ™¯é€‰æ‹©ä¸‹æ‹‰æ¡†
                    populateSceneSelect('categoryScene');
                    populateSceneSelect('vocabScene');
                    populateSceneSelect('batchScene');
                    
                    updateCustomStatus("æ‰€æœ‰è‡ªå®šä¹‰å†…å®¹å·²é‡ç½®ï¼");
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    hideModal('manageCustomModal');
                }
            });
        });
    </script>
</body>
</html>